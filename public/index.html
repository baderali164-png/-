<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سبعة الديمن</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
    --bg-color: #d4b895; /* لون خلفية رملي/بيج */
    --carpet-color: #963c3c; /* لون السجادة الأساسي */
    --accent-gold: #f0c040;
    --text-dark: #2c1e12;
}

* { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
body {
    width: 100vw; height: 100vh; overflow: hidden;
    font-family: 'Tajawal', sans-serif;
    background-color: var(--bg-color);
    /* خلفية زخرفية خفيفة */
    background-image: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.1) 100%),
                      repeating-linear-gradient(45deg, rgba(0,0,0,0.02) 0px, rgba(0,0,0,0.02) 2px, transparent 2px, transparent 4px);
    display: flex; justify-content: center; align-items: center;
}

/* === طاولة اللعب === */
#game-table {
    position: relative;
    width: 100%; max-width: 1200px;
    height: 100%; max-height: 800px;
    display: flex; justify-content: center; align-items: center;
}

/* === السجادة الوسطية (ستايل السدو) === */
.central-board {
    position: absolute;
    width: 60%; height: 55%;
    background-color: var(--carpet-color);
    /* محاكاة نقشة السدو */
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 20px, rgba(0,0,0,0.1) 20px, rgba(0,0,0,0.1) 40px),
        repeating-linear-gradient(90deg, 
            #7a2e2e 0px, #7a2e2e 10px, 
            #c98a4b 10px, #c98a4b 20px,
            #2e4a3d 20px, #2e4a3d 30px);
    border: 8px solid #4a2e1f;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5) inset, 0 5px 15px rgba(0,0,0,0.3);
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 خانات للأنواع */
    gap: 10px;
    padding: 20px;
    align-items: center; justify-items: center;
}

/* أماكن الأوراق في الوسط */
.suit-pile {
    width: 90px; height: 130px;
    background: rgba(0,0,0,0.2);
    border: 2px dashed rgba(255,255,255,0.3);
    border-radius: 8px;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    position: relative;
}
/* الكرت الملعوب في الوسط */
.played-card {
    position: absolute; top:0; left:0;
    width: 100%; height: 100%;
    background: white; border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex; justify-content: center; align-items: center;
    font-weight: bold; font-size: 1.2rem;
    background-size: cover; background-position: center;
}

/* === مناطق اللاعبين === */
.player-area { position: absolute; display: flex; flex-direction: column; align-items: center; gap: 10px; }
.player-top { top: 20px; }
.player-left { left: 20px; top: 50%; transform: translateY(-50%); }
.player-right { right: 20px; top: 50%; transform: translateY(-50%); }
.player-bottom { bottom: 30px; width: 100%; }

/* الأفاتار ومعلومات اللاعب */
.avatar-container {
    position: relative;
    width: 70px; height: 70px;
    background: #eee; border-radius: 50%;
    border: 3px solid #fff;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    display: flex; justify-content: center; align-items: center;
    font-weight: bold; color: var(--text-dark);
    z-index: 2;
}
.avatar-container.active-turn { border-color: var(--accent-gold); box-shadow: 0 0 20px var(--accent-gold); }
.player-name { position: absolute; bottom: -25px; white-space: nowrap; font-size: 0.9rem; background: rgba(255,255,255,0.8); padding: 2px 8px; border-radius: 10px; }

/* كروت الخصوم (المقلوبة) */
.opponent-hand { display: flex; }
.card-back {
    width: 40px; height: 60px;
    background: linear-gradient(135deg, #a83232, #7a2323);
    border: 2px solid #fff; border-radius: 6px;
    margin-left: -25px; /* التداخل */
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
.opponent-hand.vertical { flex-direction: column; }
.opponent-hand.vertical .card-back { margin-left: 0; margin-top: -45px; transform: rotate(90deg); }

/* === أوراقي (التصميم المهم) === */
.my-hand-container {
    position: relative;
    width: 100%;
    display: flex; justify-content: center;
    height: 160px; /* ارتفاع منطقة اليد */
}

.my-card {
    position: relative;
    width: 110px; height: 160px;
    background-color: white;
    border-radius: 12px;
    box-shadow: -5px 5px 15px rgba(0,0,0,0.3);
    margin-left: -60px; /* سر التداخل (Overlap) */
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: flex; flex-direction: column; justify-content: space-between;
    padding: 8px;
    font-weight: 900;
    background-size: cover; background-position: center;
}
.my-card:first-child { margin-left: 0; }
/* تأثير الرفع عند الهوفر - ستايل كملنا */
.my-card:hover {
    transform: translateY(-40px) rotate(2deg); /* يرتفع ويميل قليلاً */
    z-index: 100; /* يصير فوق الكل */
    box-shadow: 0 15px 30px rgba(0,0,0,0.4);
}
.my-card.playable {
     /* تمييز الكروت القابلة للعب */
     box-shadow: 0 0 5px var(--accent-gold), -5px 5px 15px rgba(0,0,0,0.3);
}

/* تفاصيل الكرت الداخلي */
.card-corner { font-size: 1.2rem; line-height: 1; }
.card-suit-big { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; opacity: 0.8; }
.red { color: #d40000; }
.black { color: #2c1e12; }
/* إخفاء النصوص للكروت اللي لها صور */
.has-image .card-corner, .has-image .card-suit-big { display: none; }


/* === أزرار التحكم === */
.controls { position: absolute; bottom: 200px; display: flex; gap: 15px; z-index: 20; }
.btn {
    padding: 12px 30px; border: none; border-radius: 25px;
    font-family: 'Tajawal'; font-weight: bold; font-size: 1rem;
    cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    transition: 0.2s;
}
.btn-pass { background: #e74c3c; color: white; }
.btn-pass:hover { background: #c0392b; transform: translateY(-2px); }
.btn-pass:disabled { background: #95a5a6; cursor: not-allowed; transform: none; opacity: 0.7; }

/* رسائل الحالة */
#turn-message {
    position: absolute; top: 15%;
    background: rgba(0,0,0,0.7); color: white;
    padding: 10px 20px; border-radius: 20px; font-weight: bold;
}
</style>
</head>
<body>

<div id="game-table">
    <div id="turn-message">جاري بدء اللعبة...</div>

    <div class="central-board">
        <div class="suit-pile" id="pile-H"><span style="opacity:0.3;font-size:2rem">♥</span></div>
        <div class="suit-pile" id="pile-D"><span style="opacity:0.3;font-size:2rem">♦</span></div>
        <div class="suit-pile" id="pile-S"><span style="opacity:0.3;font-size:2rem">♠</span></div>
        <div class="suit-pile" id="pile-C"><span style="opacity:0.3;font-size:2rem">♣</span></div>
    </div>

    <div class="player-area player-top">
        <div class="avatar-container" id="av-top">Top<div class="player-name">خويك</div></div>
        <div class="opponent-hand" id="hand-top"> </div>
    </div>

    <div class="player-area player-left">
        <div class="avatar-container" id="av-left">Left<div class="player-name">الخصم ١</div></div>
        <div class="opponent-hand vertical" id="hand-left"></div>
    </div>

    <div class="player-area player-right">
        <div class="avatar-container" id="av-right">Right<div class="player-name">الخصم ٢</div></div>
        <div class="opponent-hand vertical" id="hand-right"></div>
    </div>

    <div class="player-area player-bottom">
        <div class="controls">
            <button id="pass-btn" class="btn btn-pass" disabled>تـمـريـر</button>
        </div>
        <div class="my-hand-container" id="my-hand">
            </div>
        <div class="avatar-container" id="av-bottom" style="position:absolute; bottom:-40px; left:20px;">Me<div class="player-name">أنت</div></div>
    </div>
</div>


<script>
// === إعدادات اللعبة ===
const SUITS = ['H', 'D', 'S', 'C']; // هاص، ديمن، سبيت، شيريا
// الأرقام في سبعة الديمن تبدأ من 7 إلى A
const RANKS = [7, 8, 9, 10, 11, 12, 13, 14]; 
const RANK_NAMES = {11: 'J', 12: 'Q', 13: 'K', 14: 'A'};

// صور الأوراق الرسمية
const FACE_IMAGES = {
    'S11': 'https://upload.wikimedia.org/wikipedia/commons/a/a9/Jack_of_spades2.svg', 'S12': 'https://upload.wikimedia.org/wikipedia/commons/4/4d/Queen_of_spades2.svg', 'S13': 'https://upload.wikimedia.org/wikipedia/commons/f/f1/King_of_spades2.svg',
    'H11': 'https://upload.wikimedia.org/wikipedia/commons/3/34/Jack_of_hearts2.svg', 'H12': 'https://upload.wikimedia.org/wikipedia/commons/5/57/Queen_of_hearts2.svg', 'H13': 'https://upload.wikimedia.org/wikipedia/commons/7/72/King_of_hearts2.svg',
    'D11': 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Jack_of_diamonds2.svg', 'D12': 'https://upload.wikimedia.org/wikipedia/commons/8/89/Queen_of_diamonds2.svg', 'D13': 'https://upload.wikimedia.org/wikipedia/commons/d/d3/King_of_diamonds2.svg',
    'C11': 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Jack_of_clubs2.svg', 'C12': 'https://upload.wikimedia.org/wikipedia/commons/8/8b/Queen_of_clubs2.svg', 'C13': 'https://upload.wikimedia.org/wikipedia/commons/f/f4/King_of_clubs2.svg'
};

let deck = [];
let players = [[], [], [], []]; // 0:Bottom(Me), 1:Right, 2:Top, 3:Left
let boardState = { H:0, D:0, S:0, C:0 }; // آخر ورقة ملعوبة لكل نوع (0 يعني ما انلعب شي)
let turnIndex = 0; // من عليه الدور

// === دوال مساعدة ===
function getSuitIcon(suit) { return {'H':'♥','D':'♦','S':'♠','C':'♣'}[suit]; }
function isRed(suit) { return suit === 'H' || suit === 'D'; }
function getRankName(rank) { return RANK_NAMES[rank] || rank; }

// === منطق اللعبة ===
function initGame() {
    // 1. إنشاء الدقم (من 7 إلى A فقط)
    deck = [];
    SUITS.forEach(suit => {
        RANKS.forEach(rank => {
            deck.push({ suit, rank });
        });
    });

    // 2. التوزيع
    deck.sort(() => Math.random() - 0.5); // خلط
    players = [[], [], [], []];
    deck.forEach((card, i) => {
        players[i % 4].push(card);
    });

    // 3. تحديد البادئ (من معه 7 الهاص H7)
    let starterIndex = -1;
    players.forEach((hand, idx) => {
        if(hand.some(c => c.suit === 'H' && c.rank === 7)) starterIndex = idx;
        hand.sort((a,b) => (a.suit.charCodeAt(0) - b.suit.charCodeAt(0)) || (a.rank - b.rank)); // ترتيب اليد
    });
    
    turnIndex = starterIndex;
    boardState = { H:0, D:0, S:0, C:0 };
    updateUI();
    nextTurn();
}

// التحقق من صلاحية الورقة
function canPlay(card) {
    // البداية دائماً بـ 7
    if (card.rank === 7) return true;
    // أو ورقة أكبر بواحد من الموجود عالبورد
    if (boardState[card.suit] === card.rank - 1) return true;
    return false;
}

// تنفيذ اللعب
function playCard(playerIdx, cardIdx) {
    const card = players[playerIdx][cardIdx];
    if (!canPlay(card)) return;

    // تحديث البورد
    boardState[card.suit] = card.rank;
    // إزالة من اليد
    players[playerIdx].splice(cardIdx, 1);
    
    updateUI();

    // التحقق من الفوز
    if(players[playerIdx].length === 0) {
        alert(["أنت", "الخصم ٢", "خويك", "الخصم ١"][playerIdx] + " فاز!");
        return initGame(); // إعادة اللعبة
    }

    // انتقال الدور
    turnIndex = (turnIndex + 1) % 4;
    setTimeout(nextTurn, 800); // تأخير بسيط للواقعية
}

function passTurn() {
    turnIndex = (turnIndex + 1) % 4;
    nextTurn();
}

// إدارة الأدوار (بوت أو لاعب)
function nextTurn() {
    updateUI();
    const playerNames = ["أنت", "الخصم ٢", "خويك", "الخصم ١"];
    document.getElementById('turn-message').textContent = `الدور على: ${playerNames[turnIndex]}`;
    
    ['bottom','right','top','left'].forEach((pos, i) => {
       document.getElementById('av-'+pos).classList.toggle('active-turn', i === turnIndex);
    });

    if (turnIndex === 0) {
        // دوري (أنا)
        checkMyMoves();
    } else {
        // دور البوت
        setTimeout(botPlay, 1000);
    }
}

// ذكاء البوت (بسيط: يلعب أول ورقة متاحة)
function botPlay() {
    const hand = players[turnIndex];
    let played = false;
    for (let i = 0; i < hand.length; i++) {
        if (canPlay(hand[i])) {
            playCard(turnIndex, i);
            played = true;
            break;
        }
    }
    if (!played) passTurn();
}

// التحقق من حركاتي وتفعيل زر التمرير
function checkMyMoves() {
    const myHand = players[0];
    const hasMove = myHand.some(card => canPlay(card));
    document.getElementById('pass-btn').disabled = hasMove;
    updateUI(); // لتحديث الـ playable class
}

// === تحديث الواجهة (UI Rendering) ===
function updateUI() {
    // 1. تحديث البورد الوسطي
    SUITS.forEach(suit => {
        const pile = document.getElementById('pile-' + suit);
        const rank = boardState[suit];
        if (rank > 0) {
            const isFace = rank > 10;
            const imgUrl = isFace ? FACE_IMAGES[suit+rank] : '';
            const colorClass = isRed(suit) ? 'red' : 'black';
            pile.innerHTML = `
                <div class="played-card ${colorClass}" style="${isFace ? `background-image:url(${imgUrl})` : ''}">
                    ${!isFace ? getRankName(rank) + getSuitIcon(suit) : ''}
                </div>`;
        } else {
            pile.innerHTML = `<span style="opacity:0.3;font-size:2rem">${getSuitIcon(suit)}</span>`;
        }
    });

    // 2. تحديث يد الخصوم (عدد الكروت فقط)
    ['right', 'top', 'left'].forEach((pos, i) => {
        const handContainer = document.getElementById('hand-' + pos);
        handContainer.innerHTML = '';
        const count = players[i + 1].length;
        for(let j=0; j<count; j++) {
            handContainer.innerHTML += '<div class="card-back"></div>';
        }
    });

    // 3. تحديث يدي (المهم)
    const myHandContainer = document.getElementById('my-hand');
    myHandContainer.innerHTML = '';
    players[0].forEach((card, i) => {
        const isFace = card.rank > 10;
        const imgUrl = isFace ? FACE_IMAGES[card.suit+card.rank] : '';
        const colorClass = isRed(card.suit) ? 'red' : 'black';
        const playable = turnIndex === 0 && canPlay(card);
        
        const cardEl = document.createElement('div');
        cardEl.className = `my-card ${colorClass} ${playable ? 'playable' : ''} ${isFace ? 'has-image' : ''}`;
        if(isFace) cardEl.style.backgroundImage = `url(${imgUrl})`;

        cardEl.innerHTML = `
            <div class="card-corner"><div>${getRankName(card.rank)}</div><div>${getSuitIcon(card.suit)}</div></div>
            <div class="card-suit-big">${getSuitIcon(card.suit)}</div>
            <div class="card-corner" style="transform: rotate(180deg)"><div>${getRankName(card.rank)}</div><div>${getSuitIcon(card.suit)}</div></div>
        `;
        
        if (playable) {
            cardEl.onclick = () => playCard(0, i);
        }
        myHandContainer.appendChild(cardEl);
    });
}

// تشغيل اللعبة
document.getElementById('pass-btn').onclick = passTurn;
initGame();
</script>

</body>
</html>
