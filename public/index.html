<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --gold:#f0c040;
  --gold2:#c8960c;
  --bg:#c8a87a;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;overflow:hidden;background:var(--bg)}

/* ======= LOBBY ======= */
#lobby{
  position:fixed;inset:0;z-index:200;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#3d1f05 0%,#1a0d02 100%);
}
.lobby-box{
  width:90%;max-width:400px;
  background:linear-gradient(160deg,#2a1505,#1a0d02);
  border:3px solid var(--gold2);
  border-radius:20px;padding:2rem 1.8rem;
  box-shadow:0 0 60px rgba(200,150,12,.2);text-align:center;
}
.lobby-title{
  font-size:2.6rem;font-weight:900;
  background:linear-gradient(135deg,#f0c040,#fff5a0,#c8960c);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.2rem;filter:drop-shadow(0 2px 8px rgba(240,192,64,.4));
}
.lobby-suits{font-size:1.6rem;letter-spacing:.6rem;margin-bottom:1.8rem;color:rgba(255,255,255,.7)}
.lobby-suits .r{color:#e55}
.lfield{margin-bottom:1rem;text-align:right}
.lfield label{display:block;font-size:.78rem;color:rgba(240,192,64,.7);font-weight:700;margin-bottom:.3rem}
.lfield input{
  width:100%;padding:.8rem 1rem;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(240,192,64,.3);
  border-radius:10px;color:#fff;
  font-family:'Tajawal',sans-serif;font-size:.95rem;
  outline:none;text-align:right;transition:.2s;
}
.lfield input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(240,192,64,.1)}
.lfield input.code-input{text-align:center;letter-spacing:.5em;font-size:1.3rem;text-transform:uppercase}
.lbtn{
  width:100%;padding:.85rem;border:none;border-radius:12px;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:700;
  transition:.2s;margin-bottom:.6rem;
}
.lbtn.gold{background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0800;}
.lbtn.gold:hover{filter:brightness(1.1);transform:translateY(-1px)}
.lbtn.outline{background:rgba(240,192,64,.08);border:1.5px solid rgba(240,192,64,.35);color:rgba(240,192,64,.9);}
.ldivider{color:rgba(255,255,255,.25);font-size:.78rem;margin:.4rem 0 .9rem;display:flex;align-items:center;gap:.5rem}
.ldivider::before,.ldivider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.1)}
#lerr{display:none;color:#ff9999;font-size:.82rem;margin-bottom:.7rem;background:rgba(255,0,0,.1);border-radius:8px;padding:.45rem;text-align:center}

/* ======= WAITING ======= */
#waiting{
  position:fixed;inset:0;z-index:200;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#3d1f05 0%,#1a0d02 100%);
}
.w-code-label{color:rgba(255,255,255,.4);font-size:.85rem;margin-bottom:.3rem}
.w-code{font-size:3.5rem;font-weight:900;color:var(--gold);letter-spacing:.4em;filter:drop-shadow(0 0 20px rgba(240,192,64,.4));margin-bottom:.8rem}
.w-copybtn{background:none;border:1px solid rgba(240,192,64,.3);color:rgba(240,192,64,.7);border-radius:8px;padding:.35rem 1rem;cursor:pointer;font-family:'Tajawal',sans-serif;margin-bottom:1.5rem;}
.w-players{background:rgba(0,0,0,.4);border:1px solid rgba(240,192,64,.2);border-radius:14px;padding:1rem;width:90%;max-width:340px;margin-bottom:1rem;}
.wp-row{display:flex;align-items:center;gap:.8rem;padding:.45rem;border-radius:8px}
.wp-av{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.95rem;flex-shrink:0;background:linear-gradient(135deg,#8B4513,#c8960c);}
.wp-av.empty{background:rgba(255,255,255,.07);color:rgba(255,255,255,.25)}
.wp-name{font-weight:700;font-size:.9rem;color:#fff}
.wp-host{font-size:.6rem;padding:.15rem .4rem;border-radius:4px;background:var(--gold);color:#1a0800;font-weight:700;margin-right:.4rem}
.w-startbtn{background:linear-gradient(135deg,#f0c040,#c8960c);border:none;border-radius:12px;padding:.9rem 2.5rem;color:#1a0800;font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:900;cursor:pointer;margin-bottom:.5rem}
.w-msg{color:rgba(255,255,255,.3);font-size:.8rem}

/* ======= TABLE ======= */
#game{
  display:none;
  position:fixed;inset:0;
  /* Ø¨ÙŠØ¬ Ù…Ø«Ù„ ÙƒÙ…Ù„Ù†Ø§ */
  background:linear-gradient(160deg,#d4b896 0%,#c8a87a 40%,#b89460 100%);
}

/* Ø¥Ø·Ø§Ø± Ø§Ù„Ø·Ø§ÙˆÙ„Ø© */
#game::before{
  content:'';position:absolute;inset:0;
  border:6px solid #8B6040;
  box-shadow:inset 0 0 40px rgba(100,60,20,.3);
  pointer-events:none;z-index:0;
}

/* Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© - ÙƒØ¨ÙŠØ±Ø© Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
.carpet{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:min(88vw, 520px);
  height:min(62vh, 400px);
  border-radius:12px;
  z-index:1;
  overflow:hidden;
  box-shadow:
    0 0 0 5px #8B4513,
    0 0 0 9px var(--gold2),
    0 0 0 13px #6b3410,
    0 8px 40px rgba(0,0,0,.5);
}
.carpet-bg{
  width:100%;height:100%;
  background:
    repeating-linear-gradient(0deg,
      transparent 0px,transparent 22px,
      rgba(0,0,0,.12) 22px,rgba(0,0,0,.12) 24px
    ),
    linear-gradient(180deg,
      #9B1C1C 0%,#7a1515 6%,
      #2d5a1e 10%,#1e4014 16%,
      #8B6914 20%,
      #6b3010 24%,#c87820 28%,#6b3010 32%,
      #3a1a08 36%,#6b3010 40%,
      #c87820 44%,#8B6914 48%,
      #3a1a08 52%,#8B6914 56%,
      #c87820 60%,#6b3010 64%,
      #3a1a08 68%,#6b3010 72%,
      #c87820 76%,#8B6914 80%,
      #2d5a1e 84%,#1e4014 88%,
      #7a1515 94%,#9B1C1C 100%
    );
}
.carpet-overlay{
  position:absolute;inset:0;
  background:
    repeating-linear-gradient(90deg,
      transparent 0px,transparent 32px,
      rgba(180,100,20,.18) 32px,rgba(180,100,20,.18) 34px
    ),
    repeating-linear-gradient(-45deg,
      transparent 0,transparent 10px,
      rgba(0,0,0,.06) 10px,rgba(0,0,0,.06) 11px
    );
}
/* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø³Ø¬Ø§Ø¯Ø© */
.carpet::after{
  content:'';position:absolute;inset:8px;
  border:2px solid rgba(220,170,40,.35);
  border-radius:6px;z-index:2;pointer-events:none;
}

/* ======= Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„ÙˆØ³Ø· - Ø·ÙˆÙ„ÙŠØ© ÙˆÙƒØ¨ÙŠØ±Ø© ======= */
.board-area{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  z-index:5;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:center;
}
/* 4 Ø£ÙˆØ±Ø§Ù‚ Ø·ÙˆÙ„ÙŠØ© */
.bc-wrap{
  display:flex;flex-direction:column;align-items:center;gap:4px;
  cursor:pointer;
}
.bc{
  width:min(13vw,68px);
  height:min(19vw,98px);
  border-radius:8px;
  box-shadow:0 4px 16px rgba(0,0,0,.6);
  display:flex;flex-direction:column;justify-content:space-between;
  padding:5px 6px;
  position:relative;
  font-weight:900;
  transition:.15s;
}
.bc.white-card{
  background:linear-gradient(145deg,#fffef5,#f0eed5);
  color:#1a1a1a;
}
.bc.white-card.r{color:#cc0000}
.bc.seven{
  box-shadow:0 0 0 3px #f0c040, 0 4px 16px rgba(0,0,0,.6), 0 0 20px rgba(240,192,64,.4);
}
.bc.empty-slot{
  background:rgba(0,0,0,.18);
  border:2px dashed rgba(255,255,255,.18);
  box-shadow:none;
}
.bc .corner{font-size:.78rem;line-height:1.1}
.bc .mid{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:1.7rem;
}
/* ØµÙˆØ± Ø§Ù„ÙˆØ¬ÙˆÙ‡ Ù„Ù„Ù€ J Q K A */
.bc .face-img{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  font-size:2.4rem;
  pointer-events:none;
}
.bc-range{
  font-size:.55rem;
  background:rgba(0,0,0,.45);
  color:rgba(255,255,255,.65);
  border-radius:4px;padding:1px 5px;
  white-space:nowrap;
}

/* ======= TOP BAR ======= */
.topbar{
  position:absolute;top:0;left:0;right:0;
  display:flex;justify-content:space-between;align-items:center;
  padding:.35rem .8rem;
  background:rgba(0,0,0,.2);
  z-index:20;pointer-events:none;
}
.topbar-title{font-weight:900;font-size:.9rem;color:#5a2800;text-shadow:0 1px 0 rgba(255,255,255,.3)}
.topbar-room{font-size:.68rem;color:rgba(90,40,0,.7)}

/* ======= Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ======= */

/* --- Ù„Ø§Ø¹Ø¨ ÙÙˆÙ‚ --- */
.opp-top{
  position:absolute;
  top:2px;left:50%;transform:translateX(-50%);
  display:flex;flex-direction:column;align-items:center;
  z-index:15;
}
.opp-info{
  background:rgba(255,255,255,.25);
  border:1px solid rgba(255,255,255,.4);
  border-radius:50px;
  padding:3px 10px 3px 8px;
  display:flex;align-items:center;gap:5px;
  font-size:.75rem;font-weight:700;
  white-space:nowrap;
  color:#3a1a00;
  margin:2px 0;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
}
.opp-info.turn{
  background:rgba(240,192,64,.3);
  border-color:var(--gold);
  box-shadow:0 0 10px rgba(240,192,64,.4);
}
.opp-info.out{opacity:.4}
.opp-av{
  width:28px;height:28px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.8rem;font-weight:900;color:#fff;flex-shrink:0;
}

/* Ø£ÙˆØ±Ø§Ù‚ Ø®ØµÙ… ÙÙˆÙ‚ - Ø£ÙÙ‚ÙŠØ© ÙƒØ¨ÙŠØ±Ø© */
.opp-cards-h{
  display:flex;
  justify-content:center;
}
.opp-cb-h{
  width:min(9vw,48px);
  height:min(13vw,68px);
  background:linear-gradient(145deg,#1a0800,#3a1a05);
  border:1.5px solid rgba(200,150,12,.4);
  border-radius:6px;
  box-shadow:1px 2px 6px rgba(0,0,0,.5);
  margin:-10px;
  background-image:
    repeating-linear-gradient(45deg,transparent,transparent 4px,rgba(255,255,255,.04) 4px,rgba(255,255,255,.04) 5px),
    linear-gradient(145deg,#2a1005,#4a2010);
  position:relative;
}
.opp-cb-h::after{
  content:'';position:absolute;inset:3px;
  border:1px solid rgba(200,150,12,.2);border-radius:3px;
}

/* --- Ù„Ø§Ø¹Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± --- */
.opp-side{
  position:absolute;top:50%;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:15;gap:4px;
  transform:translateY(-50%);
}
.opp-side.right{right:2px;}
.opp-side.left{left:2px;}

/* Ø£ÙˆØ±Ø§Ù‚ Ø®ØµÙ… Ø¬Ø§Ù†Ø¨ - Ø¹Ù…ÙˆØ¯ÙŠØ© ÙƒØ¨ÙŠØ±Ø© */
.opp-cards-v{
  display:flex;flex-direction:column;
  align-items:center;
}
.opp-cb-v{
  width:min(13vw,68px);
  height:min(9vw,48px);
  background:linear-gradient(145deg,#1a0800,#3a1a05);
  border:1.5px solid rgba(200,150,12,.4);
  border-radius:6px;
  box-shadow:1px 2px 6px rgba(0,0,0,.5);
  margin:-10px 0;
  background-image:
    repeating-linear-gradient(45deg,transparent,transparent 4px,rgba(255,255,255,.04) 4px,rgba(255,255,255,.04) 5px),
    linear-gradient(145deg,#2a1005,#4a2010);
  position:relative;
}
.opp-cb-v::after{
  content:'';position:absolute;inset:3px;
  border:1px solid rgba(200,150,12,.2);border-radius:3px;
}

/* --- Ø£Ù†Ø§ ØªØ­Øª --- */
.me-zone{
  position:absolute;bottom:0;left:0;right:0;
  display:flex;flex-direction:column;align-items:center;
  z-index:15;padding-bottom:6px;
}
.me-bar{
  display:flex;align-items:center;gap:.5rem;
  background:rgba(255,255,255,.25);
  border:1px solid rgba(255,255,255,.4);
  border-radius:50px;
  padding:4px 12px 4px 8px;
  margin-bottom:5px;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
}
.me-bar.my-turn{
  background:rgba(240,192,64,.3);
  border-color:var(--gold);
  box-shadow:0 0 12px rgba(240,192,64,.35);
}
.me-av{
  width:32px;height:32px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.9rem;font-weight:900;color:#fff;flex-shrink:0;
}
.me-name{font-size:.8rem;font-weight:700;color:#3a1a00}
.me-cnt{font-size:.65rem;color:rgba(58,26,0,.6)}
.pass-btn{
  background:rgba(240,192,64,.2);
  border:1.5px solid rgba(200,130,10,.5);
  color:#5a3000;border-radius:20px;
  padding:.28rem .8rem;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:.72rem;font-weight:700;
  transition:.2s;
}
.pass-btn:disabled{opacity:.25;cursor:default}
.pass-btn:not(:disabled):hover{background:rgba(240,192,64,.4)}

/* Ø£ÙˆØ±Ø§Ù‚ ÙŠØ¯ÙŠ - ÙƒØ¨ÙŠØ±Ø© Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© */
.my-cards{
  display:flex;gap:4px;overflow-x:auto;
  padding:4px 10px 6px;max-width:100vw;
  scrollbar-width:none;
}
.my-cards::-webkit-scrollbar{display:none}

/* Ø§Ù„ÙˆØ±Ù‚Ø© - Ø¨Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± */
.hc{
  flex-shrink:0;
  width:min(15vw,78px);
  height:min(22vw,112px);
  background:linear-gradient(145deg,#fffef5,#eeecda);
  border-radius:8px;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:5px 6px;
  box-shadow:0 5px 16px rgba(0,0,0,.5);
  cursor:not-allowed;transition:.15s;
  color:#1a1a1a;position:relative;
}
.hc.r{color:#cc0000}
.hc.ok{
  cursor:pointer;
  box-shadow:0 0 0 3px var(--gold),0 8px 20px rgba(0,0,0,.4);
  transform:translateY(-14px);
}
.hc.ok:hover{transform:translateY(-20px)}
.hc .hcor{font-size:.82rem;font-weight:900;line-height:1.1}
.hc .hctr{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:min(5vw,26px);
  pointer-events:none;
}
/* ØµÙˆØ±Ø© Ø§Ù„ÙˆØ¬Ù‡ ÙÙŠ Ø§Ù„ÙˆØ±Ù‚Ø© */
.hc .face{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  font-size:min(7vw,36px);
  pointer-events:none;
  line-height:1;
}

/* Turn label */
.turn-lbl{
  position:absolute;bottom:6px;left:50%;transform:translateX(-50%);
  z-index:6;
  font-weight:900;font-size:.75rem;
  padding:.25rem .8rem;border-radius:20px;
  white-space:nowrap;pointer-events:none;
}
.turn-lbl.me{background:rgba(240,192,64,.9);color:#1a0800}
.turn-lbl.opp-t{background:rgba(0,0,0,.55);color:rgba(255,255,255,.8)}

/* ======= GAME OVER ======= */
#gameover{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,.82);backdrop-filter:blur(6px);z-index:300;
}
.go-box{
  background:linear-gradient(145deg,#2a1204,#1a0900);
  border:3px solid var(--gold2);border-radius:22px;
  padding:2rem 1.8rem;text-align:center;max-width:310px;width:88%;
}
.go-icon{font-size:3.5rem;margin-bottom:.4rem}
.go-title{font-size:1.7rem;font-weight:900;color:var(--gold);margin-bottom:.4rem}
.go-loser{font-size:1rem;color:#ff9999;margin-bottom:.3rem}
.go-sub{font-size:.8rem;color:rgba(255,255,255,.35);margin-bottom:1.3rem}
.go-btn{width:100%;padding:.82rem;border:none;border-radius:11px;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:.95rem;font-weight:700;margin-bottom:.5rem}
.go-btn.gold{background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0800}
.go-btn.out{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.55)}

/* Board Popup */
#boardpop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:250;}
.bp-inner{background:linear-gradient(145deg,#1e0e04,#130900);border:2px solid rgba(240,192,64,.3);border-radius:18px;padding:.9rem;max-width:340px;width:92%;}
.bp-title{text-align:center;color:var(--gold);font-weight:700;font-size:.85rem;margin-bottom:.7rem}
.bp-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
.bp-col{background:rgba(0,0,0,.35);border-radius:9px;padding:.5rem}
.bp-head{font-size:1rem;font-weight:900;margin-bottom:3px}
.bp-head.r{color:#cc0000}
.bp-cards{display:flex;flex-wrap:wrap;gap:2px}
.bpc{width:26px;height:38px;background:linear-gradient(145deg,#fffef5,#eeecda);border-radius:3px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:.55rem;font-weight:900;color:#1a1a1a;box-shadow:0 1px 3px rgba(0,0,0,.4);}
.bpc.r{color:#cc0000}
.bpc.sv{background:linear-gradient(145deg,#ffd700,#ffa500);box-shadow:0 0 5px rgba(255,200,0,.5)}
.bp-close{width:100%;margin-top:.7rem;background:rgba(240,192,64,.1);border:1px solid rgba(240,192,64,.25);color:rgba(240,192,64,.75);border-radius:8px;padding:.45rem;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:.8rem}

.toast{position:fixed;top:1.2rem;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.92);border:1px solid rgba(240,192,64,.35);border-radius:11px;padding:.55rem 1.1rem;font-size:.85rem;z-index:999;animation:fout 3s forwards;pointer-events:none;white-space:nowrap;color:#f0c040;}
@keyframes fout{0%,65%{opacity:1}100%{opacity:0}}
</style>
</head>
<body>

<!-- LOBBY -->
<div id="lobby">
  <div class="lobby-box">
    <div class="lobby-title">Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="lobby-suits">â™  <span class="r">â™¥</span> <span class="r">â™¦</span> â™£</div>
    <div id="lerr"></div>
    <div class="lfield">
      <label>Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label>
      <input id="pname" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="16">
    </div>
    <button class="lbtn gold" onclick="createRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <div class="ldivider">Ø£Ùˆ Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ©</div>
    <div class="lfield">
      <label>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label>
      <input id="rcode" type="text" class="code-input" placeholder="AB12CD" maxlength="6">
    </div>
    <button class="lbtn outline" onclick="joinRoom()">ğŸ”‘ Ø§Ù†Ø¶Ù… Ù„Ù„ØºØ±ÙØ©</button>
  </div>
</div>

<!-- WAITING -->
<div id="waiting">
  <div class="w-code-label">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
  <div class="w-code" id="wcode">------</div>
  <button class="w-copybtn" onclick="copyCode()">ğŸ“‹ Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  <div class="w-players">
    <div style="color:var(--gold);font-weight:700;margin-bottom:.7rem;font-size:.9rem">ğŸ® Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</div>
    <div id="wplayers"></div>
  </div>
  <button class="w-startbtn" id="startbtn" onclick="startGame()" style="display:none">ğŸƒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  <div class="w-msg" id="wmsg">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ...</div>
</div>

<!-- GAME -->
<div id="game">
  <div class="topbar">
    <div class="topbar-title">ğŸƒ Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="topbar-room" id="toproom"></div>
  </div>

  <!-- Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© -->
  <div class="carpet"><div class="carpet-bg"><div class="carpet-overlay"></div></div></div>

  <!-- Ø§Ù„Ø¨ÙˆØ±Ø¯ - 4 Ø£ÙˆØ±Ø§Ù‚ Ø·ÙˆÙ„ÙŠØ© ÙÙˆÙ‚ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© -->
  <div class="board-area" id="board-area" onclick="openBoardPop()" style="cursor:pointer"></div>

  <!-- Turn -->
  <div class="turn-lbl" id="turnlbl">â³</div>

  <!-- ÙÙˆÙ‚ -->
  <div class="opp-top" id="opp-top" style="display:none">
    <div class="opp-info" id="oinfo-top">
      <div class="opp-av" id="oav-top">?</div>
      <span id="oname-top">-</span>
    </div>
    <div class="opp-cards-h" id="ohand-top"></div>
  </div>

  <!-- ÙŠÙ…ÙŠÙ† -->
  <div class="opp-side right" id="opp-right" style="display:none">
    <div class="opp-info" id="oinfo-right">
      <div class="opp-av" id="oav-right">?</div>
      <span id="oname-right">-</span>
    </div>
    <div class="opp-cards-v" id="ohand-right"></div>
  </div>

  <!-- ÙŠØ³Ø§Ø± -->
  <div class="opp-side left" id="opp-left" style="display:none">
    <div class="opp-info" id="oinfo-left">
      <div class="opp-av" id="oav-left">?</div>
      <span id="oname-left">-</span>
    </div>
    <div class="opp-cards-v" id="ohand-left"></div>
  </div>

  <!-- Ø£Ù†Ø§ ØªØ­Øª -->
  <div class="me-zone">
    <div class="me-bar" id="me-bar">
      <div class="me-av" id="me-av">Ø£</div>
      <span class="me-name" id="me-name">-</span>
      <span class="me-cnt">(<span id="mycount">0</span>)</span>
      <button class="pass-btn" id="passbtn" onclick="sendPass()" disabled>ØªÙ…Ø±ÙŠØ± â†©</button>
    </div>
    <div class="my-cards" id="myhand"></div>
  </div>
</div>

<!-- BOARD POPUP -->
<div id="boardpop" onclick="closeBoardPop()">
  <div class="bp-inner" onclick="event.stopPropagation()">
    <div class="bp-title">ğŸ“‹ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ¨Ø¨</div>
    <div class="bp-grid" id="bp-grid"></div>
    <button class="bp-close" onclick="closeBoardPop()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- GAME OVER -->
<div id="gameover">
  <div class="go-box">
    <div class="go-icon">ğŸ˜‚</div>
    <div class="go-title">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©!</div>
    <div class="go-loser" id="goloser"></div>
    <div class="go-sub">Ù…Ù† ÙŠØ±ÙŠØ¯ Ø¬ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ØŸ</div>
    <button class="go-btn gold" id="gobtn" onclick="sendRestart()" style="display:none">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <button class="go-btn out" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>
</div>

<script>
// ===== ØµÙˆØ± Ø§Ù„ÙˆØ¬ÙˆÙ‡ Ù„Ù„Ù€ J Q K A =====
const FACE_EMOJI = {
  // J = ÙˆÙ„Ø¯
  'â™ J':'ğŸ¤´','â™¥J':'ğŸ¤´','â™¦J':'ğŸ¤´','â™£J':'ğŸ¤´',
  // Q = Ø¨Ù†Øª
  'â™ Q':'ğŸ‘¸','â™¥Q':'ğŸ‘¸','â™¦Q':'ğŸ‘¸','â™£Q':'ğŸ‘¸',
  // K = Ø´Ø§ÙŠØ¨/Ù…Ù„Ùƒ
  'â™ K':'ğŸ‘‘','â™¥K':'ğŸ‘‘','â™¦K':'ğŸ‘‘','â™£K':'ğŸ‘‘',
  // A = Ø¢ÙƒÙ‡
  'â™ A':'ğŸ…°','â™¥A':'ğŸ…°','â™¦A':'ğŸ…°','â™£A':'ğŸ…°',
};

const FACE_CHARS = {11:'J',12:'Q',13:'K',14:'A'};
const RED={'â™¥':1,'â™¦':1};
const OPP_COLORS=['#e74c8b','#3498db','#e67e22','#9b59b6'];
const WS_URL=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.host}`;
let ws,myId,myRoomId,isHost=false,myName='',lastState=null;

function vd(v){ return FACE_CHARS[v]||String(v); }
function faceEmoji(suit,val){
  const k = suit + vd(val);
  return FACE_EMOJI[k]||null;
}

/* ØµÙˆØ±Ø© ÙˆØ±Ù‚Ø© Ø§Ù„Ø¨Ù„ÙˆØª SVG Ù…Ø¨Ø³Ø·Ø© */
function makeFaceHTML(suit, val, isRed){
  const label = vd(val);
  const emoji = faceEmoji(suit,val);
  if(emoji && (val>=11)){
    // J Q K A - Ø¨ØµÙˆØ±Ø©
    return `
      <div class="corner" style="color:${isRed?'#cc0000':'#1a1a1a'}">
        <div>${label}</div><div>${suit}</div>
      </div>
      <div class="face" style="color:${isRed?'#cc0000':'#1a1a1a'}">${emoji}</div>
      <div class="corner" style="transform:rotate(180deg);color:${isRed?'#cc0000':'#1a1a1a'}">
        <div>${label}</div><div>${suit}</div>
      </div>`;
  }
  // Ø£Ø±Ù‚Ø§Ù… Ø¹Ø§Ø¯ÙŠØ©
  const suitGrid = makeSuitGrid(suit, val, isRed);
  return `
    <div class="hcor"><div>${label}</div><div>${suit}</div></div>
    <div class="hctr" style="color:${isRed?'#cc0000':'#1a1a1a'}">${suitGrid}</div>
    <div class="hcor" style="transform:rotate(180deg)"><div>${label}</div><div>${suit}</div></div>`;
}

function makeBoardCardHTML(suit, val, isRed){
  const label = vd(val);
  const emoji = faceEmoji(suit,val);
  if(emoji && val>=11){
    return `
      <div class="corner" style="font-size:.7rem;font-weight:900;line-height:1.1;color:${isRed?'#cc0000':'#1a1a1a'}">
        <div>${label}</div><div>${suit}</div>
      </div>
      <div class="face-img" style="color:${isRed?'#cc0000':'#1a1a1a'}">${emoji}</div>
      <div class="corner" style="font-size:.7rem;font-weight:900;line-height:1.1;transform:rotate(180deg);color:${isRed?'#cc0000':'#1a1a1a'}">
        <div>${label}</div><div>${suit}</div>
      </div>`;
  }
  return `
    <div class="corner" style="font-size:.7rem;font-weight:900;line-height:1.1;color:${isRed?'#cc0000':'#1a1a1a'}">
      <div>${label}</div><div>${suit}</div>
    </div>
    <div class="mid" style="color:${isRed?'#cc0000':'#1a1a1a'}">${suit}</div>
    <div class="corner" style="font-size:.7rem;font-weight:900;line-height:1.1;transform:rotate(180deg);color:${isRed?'#cc0000':'#1a1a1a'}">
      <div>${label}</div><div>${suit}</div>
    </div>`;
}

// Ø±Ø³Ù… Ø±Ù…ÙˆØ² Ø§Ù„ÙƒØ¨Ø© Ù„Ù„Ø£Ø±Ù‚Ø§Ù…
function makeSuitGrid(suit,val,isRed){
  // Ù†Ø±Ø¬Ø¹ ÙÙ‚Ø· Ø±Ù…Ø² Ø§Ù„ÙƒØ¨Ø© Ø¨Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨
  return `<span style="color:${isRed?'#cc0000':'#1a1a1a'};font-size:1.4rem">${suit}</span>`;
}

/* ---- connection ---- */
function connect(cb){
  ws=new WebSocket(WS_URL);
  ws.onopen=cb;
  ws.onmessage=e=>handle(JSON.parse(e.data));
  ws.onclose=()=>toast('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ˜','#f66');
}
function createRoom(){
  myName=document.getElementById('pname').value.trim();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  connect(()=>ws.send(JSON.stringify({type:'create_room',name:myName})));
}
function joinRoom(){
  myName=document.getElementById('pname').value.trim();
  const c=document.getElementById('rcode').value.trim().toUpperCase();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  if(!c){showErr('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');return;}
  connect(()=>ws.send(JSON.stringify({type:'join_room',roomId:c,name:myName})));
}
function startGame(){ws.send(JSON.stringify({type:'start_game'}));}
function sendPass(){ws.send(JSON.stringify({type:'pass'}));}
function sendRestart(){ws.send(JSON.stringify({type:'restart'}));}
function copyCode(){navigator.clipboard.writeText(myRoomId);toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® ğŸ“‹');}

function showErr(m){const e=document.getElementById('lerr');e.textContent=m;e.style.display='block';setTimeout(()=>e.style.display='none',3500);}
function toast(msg,color='#f0c040'){
  const t=document.createElement('div');t.className='toast';t.textContent=msg;
  t.style.color=color;document.body.appendChild(t);setTimeout(()=>t.remove(),3100);
}

function handle(msg){
  if(msg.type==='room_created'){
    myId=msg.playerId;myRoomId=msg.roomId;isHost=true;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
    document.getElementById('startbtn').style.display='block';
    document.getElementById('wmsg').textContent='Ø´Ø§Ø±Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø£ØµØ­Ø§Ø¨Ùƒ';
  }
  else if(msg.type==='joined_room'){
    myId=msg.playerId;myRoomId=msg.roomId;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
  }
  else if(msg.type==='player_list'){renderWaiting(msg.players);}
  else if(msg.type==='game_started'){
    document.getElementById('waiting').style.display='none';
    document.getElementById('game').style.display='block';
    document.getElementById('gameover').style.display='none';
    document.getElementById('toproom').textContent='ØºØ±ÙØ©: '+myRoomId;
    document.getElementById('me-av').textContent=myName[0];
    document.getElementById('me-av').style.background=`linear-gradient(135deg,#8B4513,#c8960c)`;
    document.getElementById('me-name').textContent=myName;
  }
  else if(msg.type==='game_state'){lastState=msg;renderGame(msg);}
  else if(msg.type==='player_out'){toast('ğŸ‰ '+msg.playerName+' Ø£Ù†Ù‡Ù‰ Ø£ÙˆØ±Ø§Ù‚Ù‡!','#48bb78');}
  else if(msg.type==='error'){toast('âš ï¸ '+msg.msg,'#f99');}
}

function renderWaiting(players){
  const el=document.getElementById('wplayers');el.innerHTML='';
  for(let i=0;i<4;i++){
    const p=players[i];const d=document.createElement('div');d.className='wp-row';
    if(p){
      d.innerHTML=`<div class="wp-av">${p.name[0]}</div><div class="wp-name">${p.name}${p.id===myId?' (Ø£Ù†Øª)':''}${i===0?'<span class="wp-host">Ù…Ø¶ÙŠÙ</span>':''}</div>`;
    }else{
      d.innerHTML=`<div class="wp-av empty">?</div><span style="color:rgba(255,255,255,.25)">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</span>`;
    }
    el.appendChild(d);
  }
}

function getPositions(players){
  const mi=players.findIndex(p=>p.id===myId);
  const o=[];
  for(let i=1;i<players.length;i++) o.push(players[(mi+i)%players.length]);
  const pos={top:null,right:null,left:null};
  if(o.length===1) pos.top=o[0];
  else if(o.length===2){pos.right=o[0];pos.left=o[1];}
  else if(o.length===3){pos.right=o[0];pos.top=o[1];pos.left=o[2];}
  return pos;
}

function renderOpp(side,player,allPlayers,curId){
  const wrap=document.getElementById('opp-'+side);
  const info=document.getElementById('oinfo-'+side);
  const av=document.getElementById('oav-'+side);
  const nm=document.getElementById('oname-'+side);
  const hand=document.getElementById('ohand-'+side);
  if(!player){wrap.style.display='none';return;}
  wrap.style.display='flex';
  const idx=allPlayers.findIndex(p=>p.id===player.id);
  av.style.background=`linear-gradient(135deg,${OPP_COLORS[idx%4]},${OPP_COLORS[(idx+1)%4]})`;
  av.textContent=player.name[0];
  nm.textContent=player.name+(player.isOut?' âœ…':'');
  info.className='opp-info'+(player.id===curId?' turn':'')+(player.isOut?' out':'');
  const n=Math.min(player.cardCount,8);
  const isH=(side==='top');
  hand.innerHTML=Array(n).fill(`<div class="${isH?'opp-cb-h':'opp-cb-v'}"></div>`).join('');
}

function renderGame(s){
  const pos=getPositions(s.players);
  renderOpp('top',pos.top,s.players,s.currentPlayerId);
  renderOpp('right',pos.right,s.players,s.currentPlayerId);
  renderOpp('left',pos.left,s.players,s.currentPlayerId);

  document.getElementById('me-bar').className='me-bar'+(s.currentPlayerId===myId?' my-turn':'');

  // Ø§Ù„Ø¨ÙˆØ±Ø¯ - 4 Ø£ÙˆØ±Ø§Ù‚ Ø·ÙˆÙ„ÙŠØ©
  const ba=document.getElementById('board-area');ba.innerHTML='';
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=s.board[suit];const isR=RED[suit];
    const wrap=document.createElement('div');wrap.className='bc-wrap';
    if(!b){
      wrap.innerHTML=`<div class="bc empty-slot">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:rgba(255,255,255,.15);font-size:1.5rem">${suit}</div>
      </div>`;
    } else {
      const sv=b.high===7&&b.low===7;
      const card=document.createElement('div');
      card.className='bc white-card'+(isR?' r':'')+(sv?' seven':'');
      card.innerHTML=makeBoardCardHTML(suit,b.high,isR);
      const range=document.createElement('div');
      range.className='bc-range';
      range.textContent='7 â€” '+vd(b.high);
      wrap.appendChild(card);
      wrap.appendChild(range);
      ba.appendChild(wrap);
      return;
    }
    ba.appendChild(wrap);
  });

  // Turn
  const cur=s.players.find(p=>p.id===s.currentPlayerId);
  const tl=document.getElementById('turnlbl');
  if(cur){
    if(cur.id===myId){tl.textContent='â­ Ø¯ÙˆØ±Ùƒ Ø£Ù†Øª!';tl.className='turn-lbl me';}
    else{tl.textContent='â³ Ø¯ÙˆØ± '+cur.name;tl.className='turn-lbl opp-t';}
  }

  // ÙŠØ¯ÙŠ
  const hand=document.getElementById('myhand');hand.innerHTML='';
  const isMyTurn=s.currentPlayerId===myId;
  const sorted=[...s.myHand].sort((a,b)=>{
    const so={'â™ ':0,'â™¥':1,'â™¦':2,'â™£':3};
    return so[a.suit]!==so[b.suit]?so[a.suit]-so[b.suit]:a.value-b.value;
  });
  sorted.forEach(card=>{
    const valid=isMyTurn&&s.validMoves.find(c=>c.suit===card.suit&&c.value===card.value);
    const isR=RED[card.suit];
    const el=document.createElement('div');
    el.className='hc'+(isR?' r':'')+(valid?' ok':'');
    el.innerHTML=makeFaceHTML(card.suit,card.value,isR);
    if(valid) el.onclick=()=>ws.send(JSON.stringify({type:'play_card',card}));
    hand.appendChild(el);
  });
  document.getElementById('mycount').textContent=s.myHand.length;

  const pb=document.getElementById('passbtn');
  if(isMyTurn&&s.validMoves.length===0){pb.disabled=false;pb.style.opacity='1';}
  else{pb.disabled=true;pb.style.opacity='.25';}

  if(s.gameOver){
    document.getElementById('goloser').textContent='Ø§Ù„Ø®Ø§Ø³Ø±: '+s.loser+' ğŸ˜­';
    document.getElementById('gameover').style.display='flex';
    if(isHost) document.getElementById('gobtn').style.display='block';
  }
}

function openBoardPop(){
  if(!lastState) return;
  const g=document.getElementById('bp-grid');g.innerHTML='';
  const names={'â™ ':'Ø³Ø¨Ø§ØªÙŠ','â™¥':'Ù‚Ù„Ø¨','â™¦':'Ø¯ÙŠÙ…Ù†','â™£':'Ø¬Ø§Ø¬'};
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=lastState.board[suit];const isR=RED[suit];
    const col=document.createElement('div');col.className='bp-col';
    let cards='<span style="color:rgba(255,255,255,.25);font-size:.7rem">ÙØ§Ø±Øº</span>';
    if(b){
      cards='';
      for(let v=7;v<=b.high;v++){
        cards+=`<div class="bpc${isR?' r':''}${v===7?' sv':''}">${vd(v)}</div>`;
      }
    }
    col.innerHTML=`<div class="bp-head${isR?' r':''}">${suit} ${names[suit]}</div><div class="bp-cards">${cards}</div>`;
    g.appendChild(col);
  });
  document.getElementById('boardpop').style.display='flex';
}
function closeBoardPop(){document.getElementById('boardpop').style.display='none';}

document.getElementById('rcode').addEventListener('input',e=>e.target.value=e.target.value.toUpperCase());
document.getElementById('pname').addEventListener('keyup',e=>{if(e.key==='Enter') document.getElementById('rcode').focus();});
document.getElementById('rcode').addEventListener('keyup',e=>{if(e.key==='Enter') joinRoom();});
</script>
</body>
</html>
