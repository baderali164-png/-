<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --felt:#8B4513;
  --carpet-border:#c8960c;
  --gold:#f0c040;
  --gold2:#c8960c;
  --bg:#2a1a0a;
  --card-w:58px;
  --card-h:84px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;overflow:hidden;background:var(--bg)}

/* ======= LOBBY ======= */
#lobby{
  position:fixed;inset:0;z-index:200;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#3d1f05 0%,#1a0d02 100%);
}
.lobby-box{
  width:90%;max-width:400px;
  background:linear-gradient(160deg,#2a1505,#1a0d02);
  border:3px solid var(--gold2);
  border-radius:20px;padding:2rem 1.8rem;
  box-shadow:0 0 60px rgba(200,150,12,.2), inset 0 1px 0 rgba(240,192,64,.1);
  text-align:center;
}
.lobby-title{
  font-size:2.6rem;font-weight:900;
  background:linear-gradient(135deg,#f0c040,#fff5a0,#c8960c);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.2rem;text-shadow:none;
  filter:drop-shadow(0 2px 8px rgba(240,192,64,.4));
}
.lobby-suits{font-size:1.6rem;letter-spacing:.6rem;margin-bottom:1.8rem;color:rgba(255,255,255,.7)}
.lobby-suits .r{color:#e55}
.lfield{margin-bottom:1rem;text-align:right}
.lfield label{display:block;font-size:.78rem;color:rgba(240,192,64,.7);font-weight:700;margin-bottom:.3rem}
.lfield input{
  width:100%;padding:.8rem 1rem;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(240,192,64,.3);
  border-radius:10px;color:#fff;
  font-family:'Tajawal',sans-serif;font-size:.95rem;
  outline:none;text-align:right;transition:.2s;
}
.lfield input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(240,192,64,.1)}
.lfield input.code-input{text-align:center;letter-spacing:.5em;font-size:1.3rem;text-transform:uppercase}
.lbtn{
  width:100%;padding:.85rem;border:none;border-radius:12px;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:700;
  transition:.2s;margin-bottom:.6rem;
}
.lbtn.gold{background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0800;}
.lbtn.gold:hover{filter:brightness(1.1);transform:translateY(-1px)}
.lbtn.outline{background:rgba(240,192,64,.08);border:1.5px solid rgba(240,192,64,.35);color:rgba(240,192,64,.9);}
.lbtn.outline:hover{background:rgba(240,192,64,.15)}
.ldivider{color:rgba(255,255,255,.25);font-size:.78rem;margin:.4rem 0 .9rem;display:flex;align-items:center;gap:.5rem}
.ldivider::before,.ldivider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,.1)}
#lerr{display:none;color:#ff9999;font-size:.82rem;margin-bottom:.7rem;background:rgba(255,0,0,.1);border-radius:8px;padding:.45rem;text-align:center}

/* ======= WAITING ======= */
#waiting{
  position:fixed;inset:0;z-index:200;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#3d1f05 0%,#1a0d02 100%);
}
.w-code-label{color:rgba(255,255,255,.4);font-size:.85rem;margin-bottom:.3rem}
.w-code{font-size:3.5rem;font-weight:900;color:var(--gold);letter-spacing:.4em;filter:drop-shadow(0 0 20px rgba(240,192,64,.4));margin-bottom:.8rem}
.w-copybtn{background:none;border:1px solid rgba(240,192,64,.3);color:rgba(240,192,64,.7);border-radius:8px;padding:.35rem 1rem;cursor:pointer;font-family:'Tajawal',sans-serif;margin-bottom:1.5rem;transition:.2s;}
.w-copybtn:hover{background:rgba(240,192,64,.1)}
.w-players{background:rgba(0,0,0,.4);border:1px solid rgba(240,192,64,.2);border-radius:14px;padding:1rem;width:90%;max-width:340px;margin-bottom:1rem;}
.wp-row{display:flex;align-items:center;gap:.8rem;padding:.45rem;border-radius:8px}
.wp-av{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.95rem;flex-shrink:0;background:linear-gradient(135deg,#8B4513,#c8960c);}
.wp-av.empty{background:rgba(255,255,255,.07);color:rgba(255,255,255,.25);font-size:1.2rem}
.wp-name{font-weight:700;font-size:.9rem}
.wp-host{font-size:.6rem;padding:.15rem .4rem;border-radius:4px;background:var(--gold);color:#1a0800;font-weight:700;margin-right:.4rem}
.w-startbtn{background:linear-gradient(135deg,#f0c040,#c8960c);border:none;border-radius:12px;padding:.9rem 2.5rem;color:#1a0800;font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:900;cursor:pointer;transition:.2s;margin-bottom:.5rem}
.w-startbtn:hover{filter:brightness(1.1);transform:translateY(-1px)}
.w-msg{color:rgba(255,255,255,.3);font-size:.8rem}

/* ======= GAME TABLE ======= */
#game{
  display:none;
  position:fixed;inset:0;
  background:
    radial-gradient(ellipse 80% 60% at 50% 50%, #4a2208 0%, #2a1204 50%, #170900 100%);
}

/* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ø·Ø§ÙˆÙ„Ø© */
.table-frame{
  position:absolute;inset:0;
  border:8px solid #5a3010;
  box-shadow:inset 0 0 30px rgba(0,0,0,.5);
  pointer-events:none;z-index:0;
}

/* Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© - Ù†ÙØ³ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ø§Ù…Ø§Ù‹ */
.carpet{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-52%);
  width:min(72vw,320px);
  height:min(55vw,240px);
  border-radius:10px;
  z-index:1;
  overflow:hidden;
  box-shadow:0 8px 40px rgba(0,0,0,.7), 0 0 0 4px #8B4513, 0 0 0 7px var(--gold2), 0 0 0 10px #5a3010;
}

/* Ø§Ù„Ù†Ù‚ÙˆØ´ Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© Ù„Ù„Ø³Ø¬Ø§Ø¯Ø© */
.carpet-inner{
  width:100%;height:100%;
  position:relative;
  background:
    /* Ø®Ø·ÙˆØ· Ø£ÙÙ‚ÙŠØ© */
    repeating-linear-gradient(0deg,
      transparent 0px, transparent 18px,
      rgba(0,0,0,.15) 18px, rgba(0,0,0,.15) 20px
    ),
    /* ØªØ¯Ø±Ø¬ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    linear-gradient(180deg,
      #8B2500 0%,
      #7a3010 8%,
      #2d5a1e 15%,
      #1e4a14 22%,
      #8B4513 28%,
      #6b3410 35%,
      #c87820 40%,
      #8B4513 45%,
      #4a1a08 50%,
      #8B4513 55%,
      #c87820 60%,
      #6b3410 65%,
      #8B4513 72%,
      #1e4a14 78%,
      #2d5a1e 85%,
      #7a3010 92%,
      #8B2500 100%
    );
}

/* Ø²Ø®Ø§Ø±Ù Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
.carpet-pattern{
  position:absolute;inset:0;
  background:
    repeating-linear-gradient(90deg,
      transparent 0px, transparent 28px,
      rgba(180,100,20,.2) 28px, rgba(180,100,20,.2) 30px
    ),
    repeating-linear-gradient(45deg,
      transparent 0px, transparent 14px,
      rgba(0,0,0,.08) 14px, rgba(0,0,0,.08) 15px
    );
}

/* Ø¥Ø·Ø§Ø± Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
.carpet::before{
  content:'';position:absolute;inset:5px;
  border:2px solid rgba(200,150,30,.4);
  border-radius:6px;z-index:2;pointer-events:none;
}
.carpet::after{
  content:'';position:absolute;inset:10px;
  border:1px solid rgba(200,150,30,.2);
  border-radius:4px;z-index:2;pointer-events:none;
}

/* Ø§Ù„Ø¨ÙˆØ±Ø¯ ÙÙˆÙ‚ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
.board-grid{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-52%);
  z-index:5;
  display:grid;
  grid-template-columns:1fr 1fr;
  grid-template-rows:1fr 1fr;
  gap:8px;
  width:min(44vw, 190px);
}
.b-pile{
  display:flex;flex-direction:column;align-items:center;gap:3px;
  cursor:pointer;
}
.b-card{
  width:min(19vw,78px);height:min(14vw,58px);
  background:linear-gradient(145deg,#fffef5,#f0eed5);
  border-radius:5px;
  box-shadow:0 3px 10px rgba(0,0,0,.6);
  display:flex;flex-direction:column;justify-content:space-between;
  padding:3px 4px;
  color:#1a1a1a;font-weight:900;
  position:relative;
  transition:.15s;
}
.b-card.r{color:#cc0000}
.b-card.seven{box-shadow:0 0 0 2px #f0c040,0 3px 12px rgba(0,0,0,.6),0 0 15px rgba(240,192,64,.3)}
.b-card.empty{
  background:rgba(0,0,0,.25);
  border:2px dashed rgba(255,255,255,.12);
  box-shadow:none;
}
.b-card .bc{font-size:.65rem;line-height:1}
.b-card .bm{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.1rem}
.b-range{
  font-size:.52rem;color:rgba(255,255,255,.55);
  background:rgba(0,0,0,.45);border-radius:4px;
  padding:1px 4px;white-space:nowrap;
}

/* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.topbar{
  position:absolute;top:0;left:0;right:0;
  display:flex;justify-content:space-between;align-items:center;
  padding:.35rem .7rem;
  background:linear-gradient(180deg,rgba(0,0,0,.7) 0%,transparent 100%);
  z-index:20;pointer-events:none;
}
.topbar-title{font-weight:900;font-size:.88rem;color:var(--gold)}
.topbar-room{font-size:.68rem;color:rgba(255,255,255,.35)}

/* ======= Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† ======= */
/* Ø£Ù†Ø§ - ØªØ­Øª */
.me-zone{
  position:absolute;bottom:0;left:0;right:0;
  display:flex;flex-direction:column;align-items:center;
  z-index:15;padding-bottom:4px;
}
.me-info{
  display:flex;align-items:center;gap:.5rem;
  background:rgba(0,0,0,.6);
  border:1px solid rgba(240,192,64,.25);
  border-radius:10px;padding:3px 10px 3px 8px;
  margin-bottom:4px;
}
.me-info.my-turn{border-color:var(--gold);box-shadow:0 0 12px rgba(240,192,64,.3)}
.me-av{
  width:30px;height:30px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:.85rem;
  background:linear-gradient(135deg,#8B4513,#c8960c);
  flex-shrink:0;
}
.me-name{font-size:.78rem;font-weight:700;color:#fff}
.me-count{font-size:.65rem;color:rgba(240,192,64,.7);margin-right:.3rem}
.pass-btn{
  background:rgba(240,192,64,.1);border:1px solid rgba(240,192,64,.35);
  color:rgba(240,192,64,.85);border-radius:7px;
  padding:.28rem .7rem;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:.72rem;font-weight:700;
  transition:.2s;margin-right:.5rem;
}
.pass-btn:disabled{opacity:.2;cursor:default;border-color:rgba(255,255,255,.1);color:rgba(255,255,255,.3)}
.pass-btn:not(:disabled):hover{background:rgba(240,192,64,.2)}
.my-cards{
  display:flex;gap:3px;overflow-x:auto;
  padding:4px 8px 6px;max-width:100vw;
  scrollbar-width:none;
}
.my-cards::-webkit-scrollbar{display:none}

/* ÙˆØ±Ù‚Ø© ÙŠØ¯ÙŠ */
.hc{
  flex-shrink:0;
  width:var(--card-w);height:var(--card-h);
  background:linear-gradient(145deg,#fffef5,#eeecda);
  border-radius:7px;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:4px 5px;
  box-shadow:0 4px 14px rgba(0,0,0,.6);
  cursor:not-allowed;transition:.15s;
  color:#1a1a1a;position:relative;
}
.hc.r{color:#cc0000}
.hc.ok{
  cursor:pointer;
  box-shadow:0 0 0 2.5px var(--gold),0 -10px 0 rgba(240,192,64,.15),0 6px 18px rgba(0,0,0,.5);
  transform:translateY(-12px);
}
.hc.ok:hover{transform:translateY(-17px);}
.hc .hcor{font-size:.72rem;font-weight:900;line-height:1.1}
.hc .hctr{font-size:1.5rem;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}

/* Ø§Ù„Ù„Ø§Ø¹Ø¨ - ÙÙˆÙ‚ */
.opp-top{
  position:absolute;top:0;left:50%;transform:translateX(-50%);
  display:flex;flex-direction:column;align-items:center;
  z-index:15;padding-top:4px;
}
/* Ø§Ù„Ù„Ø§Ø¹Ø¨ - ÙŠÙ…ÙŠÙ† */
.opp-right{
  position:absolute;right:0;top:50%;transform:translateY(-55%);
  display:flex;flex-direction:column;align-items:center;
  z-index:15;padding-right:4px;
}
/* Ø§Ù„Ù„Ø§Ø¹Ø¨ - ÙŠØ³Ø§Ø± */
.opp-left{
  position:absolute;left:0;top:50%;transform:translateY(-55%);
  display:flex;flex-direction:column;align-items:center;
  z-index:15;padding-left:4px;
}

.opp-info{
  background:rgba(0,0,0,.65);
  border:1px solid rgba(255,255,255,.12);
  border-radius:9px;padding:3px 9px 3px 7px;
  display:flex;align-items:center;gap:5px;
  font-size:.72rem;font-weight:700;white-space:nowrap;
  margin:3px 0;
}
.opp-info.turn{border-color:var(--gold);box-shadow:0 0 10px rgba(240,192,64,.3);color:var(--gold)}
.opp-info.out{opacity:.35}
.opp-av{
  width:26px;height:26px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.75rem;font-weight:900;flex-shrink:0;
}

/* Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø®ØµÙ… Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø© */
.opp-backs{display:flex;justify-content:center}
.opp-backs.horiz .cb{
  width:34px;height:48px;
  background:linear-gradient(145deg,#1a0800,#3a1a05);
  border:1px solid rgba(200,150,12,.35);
  border-radius:5px;box-shadow:1px 1px 5px rgba(0,0,0,.5);
  margin:-7px;
  /* Ù†Ù‚ÙˆØ´ Ø¸Ù‡Ø± Ø§Ù„ÙˆØ±Ù‚Ø© */
  background-image:repeating-linear-gradient(45deg,transparent,transparent 3px,rgba(255,255,255,.04) 3px,rgba(255,255,255,.04) 4px);
}
.opp-backs.vert .cb{
  width:48px;height:34px;
  background:linear-gradient(145deg,#1a0800,#3a1a05);
  border:1px solid rgba(200,150,12,.35);
  border-radius:5px;box-shadow:1px 1px 5px rgba(0,0,0,.5);
  margin:-9px 0;
  background-image:repeating-linear-gradient(45deg,transparent,transparent 3px,rgba(255,255,255,.04) 3px,rgba(255,255,255,.04) 4px);
}

/* Turn indicator in center */
.turn-label{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,min(14vw,60px));
  z-index:6;
  background:rgba(240,192,64,.92);
  color:#1a0800;font-weight:900;font-size:.78rem;
  padding:.28rem .9rem;border-radius:20px;
  white-space:nowrap;pointer-events:none;
  box-shadow:0 2px 10px rgba(0,0,0,.4);
}
.turn-label.opp{background:rgba(0,0,0,.7);color:rgba(255,255,255,.75);}

/* ======= GAME OVER ======= */
#gameover{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,.82);backdrop-filter:blur(6px);
  z-index:300;
}
.go-box{
  background:linear-gradient(145deg,#2a1204,#1a0900);
  border:3px solid var(--gold2);
  border-radius:22px;padding:2rem 1.8rem;
  text-align:center;max-width:310px;width:88%;
  box-shadow:0 20px 60px rgba(0,0,0,.7);
}
.go-icon{font-size:3.5rem;margin-bottom:.4rem}
.go-title{font-size:1.7rem;font-weight:900;color:var(--gold);margin-bottom:.4rem}
.go-loser{font-size:1rem;color:#ff9999;margin-bottom:.3rem}
.go-sub{font-size:.8rem;color:rgba(255,255,255,.35);margin-bottom:1.3rem}
.go-btn{width:100%;padding:.82rem;border:none;border-radius:11px;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:.95rem;font-weight:700;margin-bottom:.5rem;transition:.2s}
.go-btn.gold{background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0800}
.go-btn.out{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.15);color:rgba(255,255,255,.55)}

/* ======= BOARD DETAIL POPUP ======= */
#boardpop{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,.75);z-index:250;
}
.boardpop-inner{
  background:linear-gradient(145deg,#1e0e04,#130900);
  border:2px solid rgba(240,192,64,.3);
  border-radius:18px;padding:.9rem;
  max-width:340px;width:92%;
}
.bp-title{text-align:center;color:var(--gold);font-weight:700;font-size:.85rem;margin-bottom:.7rem}
.bp-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem}
.bp-col{background:rgba(0,0,0,.35);border-radius:9px;padding:.5rem}
.bp-head{font-size:1rem;font-weight:900;margin-bottom:3px}
.bp-head.r{color:#cc0000}
.bp-cards{display:flex;flex-wrap:wrap;gap:2px}
.bpc{
  width:22px;height:32px;
  background:linear-gradient(145deg,#fffef5,#eeecda);
  border-radius:3px;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  font-size:.48rem;font-weight:900;color:#1a1a1a;
  box-shadow:0 1px 3px rgba(0,0,0,.4);
}
.bpc.r{color:#cc0000}
.bpc.sv{background:linear-gradient(145deg,#ffd700,#ffa500);box-shadow:0 0 5px rgba(255,200,0,.5)}
.bp-close{width:100%;margin-top:.7rem;background:rgba(240,192,64,.1);border:1px solid rgba(240,192,64,.25);color:rgba(240,192,64,.75);border-radius:8px;padding:.45rem;cursor:pointer;font-family:'Tajawal',sans-serif;font-size:.8rem}

/* Toast */
.toast{position:fixed;top:1.2rem;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.92);border:1px solid rgba(240,192,64,.35);border-radius:11px;padding:.55rem 1.1rem;font-size:.85rem;z-index:999;animation:fout 3s forwards;pointer-events:none;white-space:nowrap;}
@keyframes fout{0%,65%{opacity:1}100%{opacity:0}}
</style>
</head>
<body>

<!-- ======= LOBBY ======= -->
<div id="lobby">
  <div class="lobby-box">
    <div class="lobby-title">Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="lobby-suits">â™  <span class="r">â™¥</span> <span class="r">â™¦</span> â™£</div>
    <div id="lerr"></div>
    <div class="lfield">
      <label>Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</label>
      <input id="pname" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="16">
    </div>
    <button class="lbtn gold" onclick="createRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <div class="ldivider">Ø£Ùˆ Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ©</div>
    <div class="lfield">
      <label>ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</label>
      <input id="rcode" type="text" class="code-input" placeholder="AB12CD" maxlength="6">
    </div>
    <button class="lbtn outline" onclick="joinRoom()">ğŸ”‘ Ø§Ù†Ø¶Ù… Ù„Ù„ØºØ±ÙØ©</button>
  </div>
</div>

<!-- ======= WAITING ======= -->
<div id="waiting">
  <div class="w-code-label">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
  <div class="w-code" id="wcode">------</div>
  <button class="w-copybtn" onclick="copyCode()">ğŸ“‹ Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  <div class="w-players" id="wplayers-box">
    <div style="color:var(--gold);font-weight:700;margin-bottom:.7rem;font-size:.9rem">ğŸ® Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</div>
    <div id="wplayers"></div>
  </div>
  <button class="w-startbtn" id="startbtn" onclick="startGame()" style="display:none">ğŸƒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  <div class="w-msg" id="wmsg">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ...</div>
</div>

<!-- ======= GAME ======= -->
<div id="game">
  <div class="table-frame"></div>
  <div class="topbar">
    <div class="topbar-title">ğŸƒ Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="topbar-room" id="toproom"></div>
  </div>

  <!-- Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© -->
  <div class="carpet"><div class="carpet-inner"><div class="carpet-pattern"></div></div></div>

  <!-- Ø§Ù„Ø¨ÙˆØ±Ø¯ ÙÙˆÙ‚ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© -->
  <div class="board-grid" id="board-grid" onclick="openBoardPop()" style="cursor:pointer"></div>

  <!-- Turn label -->
  <div class="turn-label" id="turnlbl">â³</div>

  <!-- Ù„Ø§Ø¹Ø¨ ÙÙˆÙ‚ -->
  <div class="opp-top" id="opp-top" style="display:none">
    <div class="opp-info" id="oinfo-top">
      <div class="opp-av" id="oav-top">?</div>
      <span id="oname-top">-</span>
    </div>
    <div class="opp-backs horiz" id="ohand-top"></div>
  </div>

  <!-- Ù„Ø§Ø¹Ø¨ ÙŠÙ…ÙŠÙ† -->
  <div class="opp-right" id="opp-right" style="display:none">
    <div class="opp-backs vert" id="ohand-right"></div>
    <div class="opp-info" id="oinfo-right">
      <div class="opp-av" id="oav-right">?</div>
      <span id="oname-right">-</span>
    </div>
  </div>

  <!-- Ù„Ø§Ø¹Ø¨ ÙŠØ³Ø§Ø± -->
  <div class="opp-left" id="opp-left" style="display:none">
    <div class="opp-backs vert" id="ohand-left"></div>
    <div class="opp-info" id="oinfo-left">
      <div class="opp-av" id="oav-left">?</div>
      <span id="oname-left">-</span>
    </div>
  </div>

  <!-- Ø£Ù†Ø§ ØªØ­Øª -->
  <div class="me-zone">
    <div class="me-info" id="me-info">
      <div class="me-av" id="me-av">Ø£</div>
      <span class="me-name" id="me-name">-</span>
      <span class="me-count">(<span id="mycount">0</span>)</span>
      <button class="pass-btn" id="passbtn" onclick="sendPass()" disabled>ØªÙ…Ø±ÙŠØ±</button>
    </div>
    <div class="my-cards" id="myhand"></div>
  </div>
</div>

<!-- ======= BOARD POPUP ======= -->
<div id="boardpop" onclick="closeBoardPop()">
  <div class="boardpop-inner" onclick="event.stopPropagation()">
    <div class="bp-title">ğŸ“‹ Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØ¨Ø¨</div>
    <div class="bp-grid" id="bp-grid"></div>
    <button class="bp-close" onclick="closeBoardPop()">Ø¥ØºÙ„Ø§Ù‚</button>
  </div>
</div>

<!-- ======= GAME OVER ======= -->
<div id="gameover">
  <div class="go-box">
    <div class="go-icon">ğŸ˜‚</div>
    <div class="go-title">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©!</div>
    <div class="go-loser" id="goloser"></div>
    <div class="go-sub">Ù…Ù† ÙŠØ±ÙŠØ¯ Ø¬ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ØŸ</div>
    <button class="go-btn gold" id="gobtn" onclick="sendRestart()" style="display:none">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <button class="go-btn out" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>
</div>

<script>
const VALS={11:'J',12:'Q',13:'K',14:'A'};
const RED={'â™¥':1,'â™¦':1};
const OPP_COLORS=['#e74c8b','#3498db','#e67e22'];
const WS_URL=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.host}`;
let ws,myId,myRoomId,isHost=false,myName='',lastState=null;

/* ---- connection ---- */
function connect(cb){
  ws=new WebSocket(WS_URL);
  ws.onopen=cb;
  ws.onmessage=e=>handle(JSON.parse(e.data));
  ws.onclose=()=>toast('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ˜','#f66');
}
function createRoom(){
  myName=document.getElementById('pname').value.trim();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  connect(()=>ws.send(JSON.stringify({type:'create_room',name:myName})));
}
function joinRoom(){
  myName=document.getElementById('pname').value.trim();
  const c=document.getElementById('rcode').value.trim().toUpperCase();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  if(!c){showErr('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');return;}
  connect(()=>ws.send(JSON.stringify({type:'join_room',roomId:c,name:myName})));
}
function startGame(){ws.send(JSON.stringify({type:'start_game'}));}
function sendPass(){ws.send(JSON.stringify({type:'pass'}));}
function sendRestart(){ws.send(JSON.stringify({type:'restart'}));}
function copyCode(){navigator.clipboard.writeText(myRoomId);toast('ØªÙ… Ø§Ù„Ù†Ø³Ø® ğŸ“‹');}

function showErr(m){const e=document.getElementById('lerr');e.textContent=m;e.style.display='block';setTimeout(()=>e.style.display='none',3500);}
function toast(msg,color='#f0c040'){
  const t=document.createElement('div');t.className='toast';t.textContent=msg;
  t.style.color=color;t.style.borderColor=color+'55';
  document.body.appendChild(t);setTimeout(()=>t.remove(),3100);
}

/* ---- handle messages ---- */
function handle(msg){
  if(msg.type==='room_created'){
    myId=msg.playerId;myRoomId=msg.roomId;isHost=true;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
    document.getElementById('startbtn').style.display='block';
    document.getElementById('wmsg').textContent='Ø´Ø§Ø±Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø£ØµØ­Ø§Ø¨Ùƒ';
  }
  else if(msg.type==='joined_room'){
    myId=msg.playerId;myRoomId=msg.roomId;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
  }
  else if(msg.type==='player_list'){renderWaiting(msg.players);}
  else if(msg.type==='game_started'){
    document.getElementById('waiting').style.display='none';
    document.getElementById('game').style.display='block';
    document.getElementById('gameover').style.display='none';
    document.getElementById('toproom').textContent='ØºØ±ÙØ©: '+myRoomId;
    document.getElementById('me-av').textContent=myName[0];
    document.getElementById('me-name').textContent=myName;
  }
  else if(msg.type==='game_state'){lastState=msg;renderGame(msg);}
  else if(msg.type==='player_out'){toast('ğŸ‰ '+msg.playerName+' Ø£Ù†Ù‡Ù‰ Ø£ÙˆØ±Ø§Ù‚Ù‡!','#48bb78');}
  else if(msg.type==='error'){toast('âš ï¸ '+msg.msg,'#f99');}
}

/* ---- waiting room ---- */
function renderWaiting(players){
  const el=document.getElementById('wplayers');el.innerHTML='';
  for(let i=0;i<4;i++){
    const p=players[i];const d=document.createElement('div');d.className='wp-row';
    if(p){
      d.innerHTML=`<div class="wp-av">${p.name[0]}</div><div class="wp-name">${p.name}${p.id===myId?' (Ø£Ù†Øª)':''}${i===0?'<span class="wp-host">Ù…Ø¶ÙŠÙ</span>':''}</div>`;
    }else{
      d.innerHTML=`<div class="wp-av empty">?</div><span style="color:rgba(255,255,255,.25)">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</span>`;
    }
    el.appendChild(d);
  }
}

/* ---- helpers ---- */
function vd(v){return VALS[v]||v;}

function getPositions(players){
  const mi=players.findIndex(p=>p.id===myId);
  const o=[];
  for(let i=1;i<players.length;i++) o.push(players[(mi+i)%players.length]);
  const pos={top:null,right:null,left:null};
  if(o.length===1) pos.top=o[0];
  else if(o.length===2){pos.right=o[0];pos.left=o[1];}
  else if(o.length===3){pos.right=o[0];pos.top=o[1];pos.left=o[2];}
  return pos;
}

function renderOpp(side,player,allPlayers,curId){
  const wrap=document.getElementById('opp-'+side);
  const info=document.getElementById('oinfo-'+side);
  const av=document.getElementById('oav-'+side);
  const nm=document.getElementById('oname-'+side);
  const hand=document.getElementById('ohand-'+side);
  if(!player){wrap.style.display='none';return;}
  wrap.style.display='flex';
  const idx=allPlayers.findIndex(p=>p.id===player.id);
  av.style.background=`linear-gradient(135deg,${OPP_COLORS[idx%3]},${OPP_COLORS[(idx+1)%3]})`;
  av.textContent=player.name[0];
  nm.textContent=player.name+(player.isOut?' âœ…':'');
  info.className='opp-info'+(player.id===curId?' turn':'')+(player.isOut?' out':'');
  const isV=(side==='left'||side==='right');
  hand.className='opp-backs '+(isV?'vert':'horiz');
  const n=Math.min(player.cardCount,10);
  hand.innerHTML=Array(n).fill('<div class="cb"></div>').join('');
}

/* ---- render game ---- */
function renderGame(s){
  const pos=getPositions(s.players);
  renderOpp('top',pos.top,s.players,s.currentPlayerId);
  renderOpp('right',pos.right,s.players,s.currentPlayerId);
  renderOpp('left',pos.left,s.players,s.currentPlayerId);

  const me=s.players.find(p=>p.id===myId);
  const mi=document.getElementById('me-info');
  mi.className='me-info'+(s.currentPlayerId===myId?' my-turn':'');

  // Ø§Ù„Ø¨ÙˆØ±Ø¯ - Ø£ÙˆØ±Ø§Ù‚ ÙÙˆÙ‚ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø©
  const bg=document.getElementById('board-grid');bg.innerHTML='';
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=s.board[suit];const isR=RED[suit];
    const pile=document.createElement('div');pile.className='b-pile';
    if(!b){
      pile.innerHTML=`<div class="b-card empty">
        <div class="bc" style="color:rgba(255,255,255,.15)">${suit}</div>
        <div class="bm" style="color:rgba(255,255,255,.1);font-size:.9rem">${suit}</div>
      </div>`;
    } else {
      const sv=b.high===7;
      pile.innerHTML=`<div class="b-card${isR?' r':''}${sv?' seven':''}">
        <div class="bc">${vd(b.high)}<br>${suit}</div>
        <div class="bm">${suit}</div>
        <div class="bc" style="transform:rotate(180deg)">${vd(b.high)}<br>${suit}</div>
      </div>
      <div class="b-range">${vd(b.low===7?7:7)}â€”${vd(b.high)}</div>`;
    }
    bg.appendChild(pile);
  });

  // Turn label
  const cur=s.players.find(p=>p.id===s.currentPlayerId);
  const tl=document.getElementById('turnlbl');
  if(cur){
    if(cur.id===myId){tl.textContent='â­ Ø¯ÙˆØ±Ùƒ!';tl.className='turn-label';}
    else{tl.textContent='â³ Ø¯ÙˆØ± '+cur.name;tl.className='turn-label opp';}
  }

  // ÙŠØ¯ÙŠ
  const hand=document.getElementById('myhand');hand.innerHTML='';
  const isMyTurn=s.currentPlayerId===myId;
  const sorted=[...s.myHand].sort((a,b)=>{
    const so={'â™ ':0,'â™¥':1,'â™¦':2,'â™£':3};
    return so[a.suit]!==so[b.suit]?so[a.suit]-so[b.suit]:a.value-b.value;
  });
  sorted.forEach(card=>{
    const valid=isMyTurn&&s.validMoves.find(c=>c.suit===card.suit&&c.value===card.value);
    const isR=RED[card.suit];
    const el=document.createElement('div');
    el.className='hc'+(isR?' r':'')+(valid?' ok':'');
    el.innerHTML=`<div class="hcor"><div>${vd(card.value)}</div><div>${card.suit}</div></div>
      <div class="hctr">${card.suit}</div>
      <div class="hcor" style="transform:rotate(180deg)"><div>${vd(card.value)}</div><div>${card.suit}</div></div>`;
    if(valid) el.onclick=()=>ws.send(JSON.stringify({type:'play_card',card}));
    hand.appendChild(el);
  });
  document.getElementById('mycount').textContent=s.myHand.length;

  // Pass btn
  const pb=document.getElementById('passbtn');
  if(isMyTurn&&s.validMoves.length===0){pb.disabled=false;pb.style.color='var(--gold)';pb.style.borderColor='rgba(240,192,64,.5)';}
  else{pb.disabled=true;pb.style.color='';pb.style.borderColor='';}

  // Game over
  if(s.gameOver){
    document.getElementById('goloser').textContent='Ø§Ù„Ø®Ø§Ø³Ø±: '+s.loser+' ğŸ˜­';
    document.getElementById('gameover').style.display='flex';
    if(isHost) document.getElementById('gobtn').style.display='block';
  }
}

/* ---- board popup ---- */
function openBoardPop(){
  if(!lastState) return;
  const g=document.getElementById('bp-grid');g.innerHTML='';
  const names={'â™ ':'Ø³Ø¨Ø§ØªÙŠ','â™¥':'Ù‚Ù„Ø¨','â™¦':'Ø¯ÙŠÙ…Ù†','â™£':'Ø¬Ø§Ø¬'};
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=lastState.board[suit];const isR=RED[suit];
    const col=document.createElement('div');col.className='bp-col';
    let cards='<span style="color:rgba(255,255,255,.25);font-size:.7rem">ÙØ§Ø±Øº</span>';
    if(b){
      cards='';
      for(let v=7;v<=b.high;v++){
        cards+=`<div class="bpc${isR?' r':''}${v===7?' sv':''}">${vd(v)}</div>`;
      }
    }
    col.innerHTML=`<div class="bp-head${isR?' r':''}">${suit} ${names[suit]}</div><div class="bp-cards">${cards}</div>`;
    g.appendChild(col);
  });
  document.getElementById('boardpop').style.display='flex';
}
function closeBoardPop(){document.getElementById('boardpop').style.display='none';}

/* ---- input events ---- */
document.getElementById('rcode').addEventListener('input',e=>e.target.value=e.target.value.toUpperCase());
document.getElementById('pname').addEventListener('keyup',e=>{if(e.key==='Enter') document.getElementById('rcode').focus();});
document.getElementById('rcode').addEventListener('keyup',e=>{if(e.key==='Enter') joinRoom();});
</script>
</body>
</html>
