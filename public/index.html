<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù† ğŸƒ</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;background:#0a1a0a;color:#fff;overflow:hidden}

/* ===== LOBBY ===== */
#lobby{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#1a472a 0%,#0d2b18 55%,#050f05 100%);
  z-index:100;
}
.lobby-inner{
  width:100%;max-width:440px;padding:1.5rem;
  text-align:center;
}
.game-title{
  font-size:3.2rem;font-weight:900;
  background:linear-gradient(135deg,#f0c040,#c8960c,#f0c040);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.3rem;
}
.suits-row{font-size:1.8rem;letter-spacing:.5rem;margin-bottom:2rem;opacity:.9}
.suits-row .r{color:#ff4444}
.card-panel{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(240,192,64,.25);
  border-radius:18px;padding:1.8rem;
  backdrop-filter:blur(12px);
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}
.flabel{font-size:.82rem;color:rgba(240,192,64,.75);text-align:right;margin-bottom:.35rem;font-weight:700}
input{
  width:100%;padding:.85rem 1rem;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(240,192,64,.2);
  border-radius:10px;color:#fff;
  font-family:'Tajawal',sans-serif;font-size:1rem;
  margin-bottom:.9rem;text-align:right;
  outline:none;transition:.2s;
}
input:focus{border-color:rgba(240,192,64,.6);box-shadow:0 0 0 3px rgba(240,192,64,.1)}
.btn-gold{
  width:100%;padding:.9rem;border:none;border-radius:12px;cursor:pointer;
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00;font-family:'Tajawal',sans-serif;
  font-size:1rem;font-weight:700;margin-bottom:.7rem;
  transition:.2s;
}
.btn-gold:hover{filter:brightness(1.1);transform:translateY(-1px)}
.divider{
  text-align:center;color:rgba(255,255,255,.3);
  font-size:.8rem;margin:.5rem 0 .9rem;
  border-bottom:1px solid rgba(255,255,255,.08);padding-bottom:.5rem;
}
.btn-outline{
  width:100%;padding:.85rem;border:1px solid rgba(240,192,64,.35);
  border-radius:12px;cursor:pointer;
  background:transparent;color:rgba(240,192,64,.85);
  font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:700;
  transition:.2s;
}
.btn-outline:hover{background:rgba(240,192,64,.1)}
#err{display:none;color:#ff9999;font-size:.85rem;margin-bottom:.7rem;
  background:rgba(255,0,0,.1);border-radius:8px;padding:.5rem;text-align:center}

/* ===== WAITING ===== */
#waiting{
  position:fixed;inset:0;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#1a472a 0%,#0d2b18 55%,#050f05 100%);
  z-index:100;
}
.big-code{
  font-size:4rem;font-weight:900;letter-spacing:.4em;
  color:#f0c040;
  filter:drop-shadow(0 0 20px rgba(240,192,64,.5));
  margin:.5rem 0 1rem;
}
.copy-btn{
  background:none;border:1px solid rgba(240,192,64,.3);
  color:rgba(240,192,64,.7);border-radius:8px;
  padding:.4rem 1rem;cursor:pointer;font-family:'Tajawal',sans-serif;
  margin-bottom:1.5rem;transition:.2s;
}
.copy-btn:hover{background:rgba(240,192,64,.1)}
.wplayers-box{
  background:rgba(255,255,255,.05);border:1px solid rgba(240,192,64,.15);
  border-radius:16px;padding:1.2rem;width:100%;max-width:380px;
  margin-bottom:1.2rem;
}
.wp{display:flex;align-items:center;gap:.8rem;padding:.5rem;border-radius:8px}
.wp-av{
  width:42px;height:42px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;font-size:1.1rem;
  background:linear-gradient(135deg,#667eea,#764ba2);
  flex-shrink:0;
}
.wp-av.empty{background:rgba(255,255,255,.08);color:rgba(255,255,255,.3);font-size:1.4rem}
.badge{
  font-size:.65rem;padding:.2rem .5rem;border-radius:4px;
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00;font-weight:700;margin-right:.4rem;
}
.btn-start{
  background:linear-gradient(135deg,#48bb78,#2f855a);
  border:none;border-radius:14px;padding:1rem 3rem;
  color:#fff;font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:700;
  cursor:pointer;transition:.2s;margin-bottom:.5rem;
}
.btn-start:hover{filter:brightness(1.1);transform:translateY(-1px)}
.wait-msg{color:rgba(255,255,255,.35);font-size:.85rem;margin-top:.5rem}

/* ===== GAME ===== */
#game{
  display:none;width:100vw;height:100vh;
  flex-direction:column;
  background:radial-gradient(ellipse at center,#215732 0%,#1a472a 40%,#133520 100%);
  position:relative;overflow:hidden;
}
.top-bar{
  display:flex;justify-content:space-between;align-items:center;
  padding:.6rem 1rem;
  background:rgba(0,0,0,.25);
  border-bottom:1px solid rgba(240,192,64,.15);
  flex-shrink:0;
}
.top-title{font-weight:900;font-size:1rem;color:#f0c040}
.top-room{font-size:.75rem;color:rgba(255,255,255,.4)}
.opps-row{
  display:flex;gap:.5rem;padding:.5rem .8rem;
  overflow-x:auto;flex-shrink:0;
}
.opp{
  background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);
  border-radius:12px;padding:.5rem .7rem;
  display:flex;align-items:center;gap:.5rem;
  min-width:110px;transition:.2s;
}
.opp.my-turn{border-color:#f0c040;box-shadow:0 0 15px rgba(240,192,64,.3)}
.opp.out{opacity:.4}
.opp-av{
  width:34px;height:34px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700;font-size:.9rem;flex-shrink:0;
}
.opp-name{font-size:.78rem;font-weight:700;white-space:nowrap}
.mini-cards{display:flex;gap:2px;flex-wrap:wrap;margin-top:2px}
.mc{width:8px;height:12px;background:rgba(255,255,255,.2);border-radius:2px}
.turn-arrow{display:none;color:#f0c040;font-size:.8rem;margin-bottom:2px}
.my-turn .turn-arrow{display:block}

.board-area{
  flex:1;overflow-y:auto;overflow-x:hidden;
  padding:.5rem;display:grid;
  grid-template-columns:repeat(4,1fr);gap:.4rem;
}
.suit-col{
  background:rgba(0,0,0,.2);border-radius:12px;
  padding:.5rem;display:flex;flex-direction:column;align-items:center;
}
.sh{font-size:1.6rem;margin-bottom:2px}
.sh.r{color:#ff4444}
.sname{font-size:.65rem;color:rgba(255,255,255,.4);margin-bottom:.4rem}
.brow{display:flex;flex-wrap:wrap;gap:2px;justify-content:center;min-height:30px;align-items:center}
.bc{
  width:28px;height:38px;
  background:linear-gradient(145deg,#fffff0,#f5f5dc);
  border-radius:4px;display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  font-size:.55rem;font-weight:700;color:#1a1a1a;
  box-shadow:0 2px 4px rgba(0,0,0,.4);
}
.bc.r{color:#cc0000}
.bc.seven{
  background:linear-gradient(145deg,#ffd700,#ffa500);
  box-shadow:0 0 8px rgba(255,200,0,.6);
}
.srange{font-size:.65rem;color:rgba(255,255,255,.4);margin-top:.3rem}

.mid-bar{
  background:rgba(0,0,0,.3);padding:.4rem .8rem;
  display:flex;justify-content:space-between;align-items:center;
  flex-shrink:0;
}
.turn-txt{font-size:.85rem;font-weight:700}
.hand-area{
  background:rgba(0,0,0,.35);
  border-top:1px solid rgba(255,255,255,.08);
  padding:.5rem;flex-shrink:0;
}
.hand-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.4rem;padding:0 .3rem}
.hand-lbl{font-size:.78rem;color:rgba(255,255,255,.5)}
.pass-btn{
  background:none;border:1px solid rgba(255,255,255,.25);
  color:rgba(255,255,255,.5);border-radius:8px;
  padding:.3rem .8rem;cursor:pointer;
  font-family:'Tajawal',sans-serif;font-size:.78rem;transition:.2s;
}
.pass-btn:not(:disabled):hover{border-color:#f0c040;color:#f0c040}
.pass-btn:disabled{opacity:.3;cursor:default}
.cards-row{display:flex;gap:5px;overflow-x:auto;padding:.3rem 0}
.hc{
  flex-shrink:0;width:58px;height:82px;
  background:linear-gradient(145deg,#fffff0,#f5f5dc);
  border-radius:7px;cursor:not-allowed;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:4px;position:relative;
  box-shadow:0 3px 8px rgba(0,0,0,.4);
  transition:.15s;
}
.hc.r{color:#cc0000}
.hc.ok{
  cursor:pointer;
  box-shadow:0 3px 8px rgba(0,0,0,.4),0 0 0 2px #f0c040,0 0 15px rgba(240,192,64,.4);
  transform:translateY(-6px);
}
.hc.ok:hover{transform:translateY(-10px);box-shadow:0 6px 16px rgba(0,0,0,.5),0 0 0 2px #f0c040,0 0 20px rgba(240,192,64,.6)}
.hc .cor{font-size:.65rem;font-weight:700;line-height:1}
.hc .ctr{font-size:1.4rem;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}

/* ===== GAME OVER ===== */
#gameover{
  position:fixed;inset:0;display:none;
  align-items:center;justify-content:center;
  background:rgba(0,0,0,.85);backdrop-filter:blur(8px);
  z-index:200;
}
.go-box{
  background:linear-gradient(135deg,#1a472a,#0d2b18);
  border:1px solid rgba(240,192,64,.3);
  border-radius:24px;padding:2.5rem 2rem;
  text-align:center;max-width:340px;width:90%;
}
.go-emoji{font-size:4rem;margin-bottom:.5rem}
.go-title{font-size:1.8rem;font-weight:900;color:#f0c040;margin-bottom:.5rem}
.go-loser{font-size:1.1rem;margin-bottom:.3rem;color:#ff9999}
.go-sub{color:rgba(255,255,255,.4);font-size:.85rem;margin-bottom:1.5rem}
.btn-restart{
  background:linear-gradient(135deg,#f0c040,#c8960c);
  border:none;border-radius:12px;padding:.85rem 2rem;
  color:#1a0f00;font-family:'Tajawal',sans-serif;
  font-size:1rem;font-weight:700;cursor:pointer;
  margin-bottom:.7rem;width:100%;transition:.2s;
}
.btn-home{
  background:none;border:1px solid rgba(255,255,255,.2);
  border-radius:12px;padding:.75rem 2rem;
  color:rgba(255,255,255,.6);font-family:'Tajawal',sans-serif;
  font-size:.9rem;cursor:pointer;width:100%;transition:.2s;
}
.toast{
  position:fixed;top:1rem;left:50%;transform:translateX(-50%);
  background:rgba(0,0,0,.9);border:1px solid rgba(240,192,64,.3);
  border-radius:12px;padding:.6rem 1.2rem;
  font-size:.9rem;z-index:9999;
  animation:fadeout 3s forwards;pointer-events:none;
}
@keyframes fadeout{0%,70%{opacity:1}100%{opacity:0}}

@media(max-width:500px){
  .board-area{grid-template-columns:repeat(2,1fr)}
  .bc{width:22px;height:30px;font-size:.45rem}
  .hc{width:48px;height:68px}
}
</style>
</head>
<body>

<!-- LOBBY -->
<div id="lobby">
  <div class="lobby-inner">
    <div class="game-title">Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="suits-row">â™  <span class="r">â™¥</span> <span class="r">â™¦</span> â™£</div>
    <div class="card-panel">
      <div id="err"></div>
      <div class="flabel">Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</div>
      <input id="pname" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="16">
      <button class="btn-gold" onclick="createRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <div class="divider">Ø£Ùˆ Ø§Ù†Ø¶Ù… Ù„ØºØ±ÙØ© Ù…ÙˆØ¬ÙˆØ¯Ø©</div>
      <div class="flabel">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
      <input id="rcode" type="text" placeholder="Ù…Ø«Ø§Ù„: AB12CD" maxlength="6"
        style="text-align:center;letter-spacing:.4em;font-size:1.4rem;text-transform:uppercase">
      <button class="btn-outline" onclick="joinRoom()">ğŸ”‘ Ø§Ù†Ø¶Ù… Ù„Ù„ØºØ±ÙØ©</button>
    </div>
  </div>
</div>

<!-- WAITING -->
<div id="waiting">
  <div style="color:rgba(255,255,255,.5);font-size:.9rem">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
  <div class="big-code" id="wcode">------</div>
  <button class="copy-btn" onclick="copyCode()">ğŸ“‹ Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  <div class="wplayers-box">
    <div style="color:#f0c040;font-weight:700;margin-bottom:.8rem">ğŸ® Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</div>
    <div id="wplayers"></div>
  </div>
  <button class="btn-start" id="startbtn" onclick="startGame()" style="display:none">ğŸƒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
  <div class="wait-msg" id="wmsg">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ...</div>
</div>

<!-- GAME -->
<div id="game">
  <div class="top-bar">
    <div class="top-title">ğŸƒ Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="top-room" id="toproom"></div>
  </div>
  <div class="opps-row" id="opps"></div>
  <div class="board-area" id="board"></div>
  <div class="mid-bar">
    <div class="turn-txt" id="turnbar">â³</div>
    <div style="font-size:.75rem;color:rgba(255,255,255,.4)">ÙˆØ±Ù‚Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø© ØªÙØªØ­ Ø§Ù„ÙƒØ¨Ø©</div>
  </div>
  <div class="hand-area">
    <div class="hand-top">
      <div class="hand-lbl">Ø£ÙˆØ±Ø§Ù‚ÙŠ â€” <span id="mycount">0</span></div>
      <button class="pass-btn" id="passbtn" onclick="sendPass()" disabled>ØªÙ…Ø±ÙŠØ± â†©</button>
    </div>
    <div class="cards-row" id="myhand"></div>
  </div>
</div>

<!-- GAME OVER -->
<div id="gameover">
  <div class="go-box">
    <div class="go-emoji">ğŸ˜‚</div>
    <div class="go-title">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø©!</div>
    <div class="go-loser" id="goloser"></div>
    <div class="go-sub">Ù…Ù† ÙŠØ±ÙŠØ¯ Ø¬ÙˆÙ„Ø© Ø£Ø®Ø±Ù‰ØŸ</div>
    <button class="btn-restart" id="gobtn" onclick="sendRestart()" style="display:none">ğŸ”„ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <button class="btn-home" onclick="location.reload()">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>
</div>

<script>
const VALS={1:'A',11:'J',12:'Q',13:'K'};
const RED={'â™¥':1,'â™¦':1};
const WS_URL=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.host}`;
let ws,myId,myRoomId,isHost=false,myName='';

function connect(cb){
  ws=new WebSocket(WS_URL);
  ws.onopen=cb;
  ws.onmessage=e=>handle(JSON.parse(e.data));
  ws.onclose=()=>toast('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ ğŸ˜','#ff6666');
}
function createRoom(){
  myName=document.getElementById('pname').value.trim();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  connect(()=>ws.send(JSON.stringify({type:'create_room',name:myName})));
}
function joinRoom(){
  myName=document.getElementById('pname').value.trim();
  const code=document.getElementById('rcode').value.trim().toUpperCase();
  if(!myName){showErr('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹');return;}
  if(!code){showErr('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©');return;}
  connect(()=>ws.send(JSON.stringify({type:'join_room',roomId:code,name:myName})));
}
function startGame(){ws.send(JSON.stringify({type:'start_game'}));}
function sendPass(){ws.send(JSON.stringify({type:'pass'}));}
function sendRestart(){ws.send(JSON.stringify({type:'restart'}));}
function copyCode(){navigator.clipboard.writeText(myRoomId);toast('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯! ğŸ“‹');}

function showErr(m){
  const e=document.getElementById('err');
  e.textContent=m;e.style.display='block';
  setTimeout(()=>e.style.display='none',3500);
}
function toast(msg,color='#f0c040'){
  const t=document.createElement('div');
  t.className='toast';t.textContent=msg;
  t.style.color=color;t.style.borderColor=color+'66';
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3100);
}

function handle(msg){
  if(msg.type==='room_created'){
    myId=msg.playerId;myRoomId=msg.roomId;isHost=true;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
    document.getElementById('startbtn').style.display='block';
    document.getElementById('wmsg').textContent='Ø´Ø§Ø±Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø£ØµØ­Ø§Ø¨Ùƒ';
  }
  else if(msg.type==='joined_room'){
    myId=msg.playerId;myRoomId=msg.roomId;
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
  }
  else if(msg.type==='player_list'){renderWaiting(msg.players);}
  else if(msg.type==='game_started'){
    document.getElementById('waiting').style.display='none';
    document.getElementById('game').style.display='flex';
    document.getElementById('gameover').style.display='none';
    document.getElementById('toproom').textContent='ØºØ±ÙØ©: '+myRoomId;
  }
  else if(msg.type==='game_state'){renderGame(msg);}
  else if(msg.type==='player_out'){toast('ğŸ‰ '+msg.playerName+' Ø£Ù†Ù‡Ù‰ Ø£ÙˆØ±Ø§Ù‚Ù‡!','#48bb78');}
  else if(msg.type==='error'){toast('âš ï¸ '+msg.msg,'#ff9999');}
}

function renderWaiting(players){
  const el=document.getElementById('wplayers');
  el.innerHTML='';
  for(let i=0;i<4;i++){
    const p=players[i];
    const d=document.createElement('div');
    d.className='wp';
    if(p){
      d.innerHTML=`<div class="wp-av">${p.name[0]}</div>
        <div><span style="font-weight:700">${p.name}${p.id===myId?' (Ø£Ù†Øª)':''}</span>
        ${i===0?'<span class="badge">Ù…Ø¶ÙŠÙ</span>':''}</div>`;
    }else{
      d.innerHTML=`<div class="wp-av empty">?</div><span style="color:rgba(255,255,255,.3)">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø§Ø¹Ø¨...</span>`;
    }
    el.appendChild(d);
  }
}

function vd(v){return VALS[v]||v;}

function renderGame(s){
  // Opponents
  const opps=document.getElementById('opps');
  opps.innerHTML='';
  const colors=['#667eea','#ed8936','#fc8181','#68d391'];
  s.players.forEach((p,idx)=>{
    if(p.id===myId)return;
    const d=document.createElement('div');
    d.className='opp'+(p.id===s.currentPlayerId?' my-turn':'')+(p.isOut?' out':'');
    d.innerHTML=`<div class="turn-arrow">ğŸ‘‡</div>
      <div class="opp-av" style="background:linear-gradient(135deg,${colors[idx%4]},${colors[(idx+1)%4]})">${p.name[0]}</div>
      <div>
        <div class="opp-name">${p.name}${p.isOut?' âœ…':''}</div>
        <div class="mini-cards">${Array(Math.min(p.cardCount,8)).fill('<div class="mc"></div>').join('')}
          ${p.cardCount>8?`<span style="font-size:.65rem;color:rgba(255,255,255,.4)">+${p.cardCount-8}</span>`:''}</div>
      </div>`;
    opps.appendChild(d);
  });

  // Board
  const board=document.getElementById('board');
  board.innerHTML='';
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=s.board[suit];
    const isR=RED[suit];
    const col=document.createElement('div');
    col.className='suit-col';
    let cards='';
    if(b){
      for(let v=b.low;v<=b.high;v++){
        cards+=`<div class="bc${isR?' r':''}${v===7?' seven':''}"><span>${suit}</span><span>${vd(v)}</span></div>`;
      }
    }
    const names={'â™ ':'Ø³Ø¨Ø§ØªÙŠ','â™¥':'Ù‚Ù„Ø¨','â™¦':'Ø¯ÙŠÙ…Ù†','â™£':'Ø¬Ø§Ø¬'};
    col.innerHTML=`<div class="sh${isR?' r':''}">${suit}</div>
      <div class="sname">${names[suit]}</div>
      <div class="brow">${cards||'<span style="color:rgba(255,255,255,.2);font-size:.7rem">â€”</span>'}</div>
      <div class="srange">${b?vd(b.low)+' â€” '+vd(b.high):'â€”'}</div>`;
    board.appendChild(col);
  });

  // Turn
  const cur=s.players.find(p=>p.id===s.currentPlayerId);
  const tb=document.getElementById('turnbar');
  if(cur){
    if(cur.id===myId){tb.innerHTML='â­ Ø¯ÙˆØ±Ùƒ Ø£Ù†Øª!';tb.style.color='#f0c040';}
    else{tb.innerHTML='â³ Ø¯ÙˆØ± '+cur.name+'...';tb.style.color='rgba(255,255,255,.5)';}
  }

  // Hand
  const hand=document.getElementById('myhand');
  hand.innerHTML='';
  const isMyTurn=s.currentPlayerId===myId;
  const sorted=[...s.myHand].sort((a,b)=>{
    const so={'â™ ':0,'â™¥':1,'â™¦':2,'â™£':3};
    return so[a.suit]!==so[b.suit]?so[a.suit]-so[b.suit]:a.value-b.value;
  });
  sorted.forEach(card=>{
    const valid=isMyTurn&&s.validMoves.find(c=>c.suit===card.suit&&c.value===card.value);
    const isR=RED[card.suit];
    const el=document.createElement('div');
    el.className='hc'+(isR?' r':'')+(valid?' ok':'');
    el.innerHTML=`<div class="cor"><div>${vd(card.value)}</div><div>${card.suit}</div></div>
      <div class="ctr">${card.suit}</div>
      <div class="cor" style="transform:rotate(180deg)"><div>${vd(card.value)}</div><div>${card.suit}</div></div>`;
    if(valid)el.onclick=()=>ws.send(JSON.stringify({type:'play_card',card}));
    hand.appendChild(el);
  });
  document.getElementById('mycount').textContent=s.myHand.length;

  // Pass btn
  const pb=document.getElementById('passbtn');
  if(isMyTurn&&s.validMoves.length===0){
    pb.disabled=false;pb.style.borderColor='var(--gold,#f0c040)';pb.style.color='#f0c040';
  }else{
    pb.disabled=true;pb.style.borderColor='';pb.style.color='';
  }

  // Game over
  if(s.gameOver){
    document.getElementById('goloser').textContent='Ø§Ù„Ø®Ø§Ø³Ø±: '+s.loser+' ğŸ˜­';
    document.getElementById('gameover').style.display='flex';
    if(isHost)document.getElementById('gobtn').style.display='block';
  }
}

document.getElementById('rcode').addEventListener('input',e=>e.target.value=e.target.value.toUpperCase());
document.getElementById('pname').addEventListener('keyup',e=>{if(e.key==='Enter')document.getElementById('rcode').focus();});
document.getElementById('rcode').addEventListener('keyup',e=>{if(e.key==='Enter')joinRoom();});
</script>
</body>
</html>
