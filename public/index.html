<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù† ğŸƒ - Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ø´Ø§Ù…Ù‰</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;background:#0a1a0a;color:#fff;overflow:hidden}

/* ===== LOBBY ===== */
#lobby{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#2d6a3f 0%,#1a3d24 55%,#0a1a0f 100%);
  z-index:100;
}
.lobby-inner{width:100%;max-width:420px;padding:1.5rem;text-align:center;}
.game-title{
  font-size:3rem;font-weight:900;
  background:linear-gradient(135deg,#f0c040,#c8960c,#f0c040);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.3rem;
}
.suits-row{font-size:1.8rem;letter-spacing:.5rem;margin-bottom:2rem;opacity:.9}
.suits-row .r{color:#ff4444}
.card-panel{
  background:rgba(0,0,0,.35);
  border:2px solid rgba(240,192,64,.3);
  border-radius:18px;padding:1.8rem;
  box-shadow:0 20px 60px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.05);
}
.flabel{font-size:.82rem;color:rgba(240,192,64,.8);text-align:right;margin-bottom:.35rem;font-weight:700}
input{
  width:100%;padding:.85rem 1rem;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(240,192,64,.25);
  border-radius:10px;color:#fff;
  font-family:'Tajawal',sans-serif;font-size:1rem;
  margin-bottom:.9rem;text-align:right;outline:none;transition:.2s;
}
input:focus{border-color:rgba(240,192,64,.7);box-shadow:0 0 0 3px rgba(240,192,64,.1)}
.btn-gold{
  width:100%;padding:.9rem;border:none;border-radius:12px;cursor:pointer;
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00;font-family:'Tajawal',sans-serif;
  font-size:1rem;font-weight:700;margin-bottom:.7rem;transition:.2s;
}
.btn-gold:hover{filter:brightness(1.1);transform:translateY(-1px)}
.divider{text-align:center;color:rgba(255,255,255,.3);font-size:.8rem;margin:.5rem 0 .9rem;border-bottom:1px solid rgba(255,255,255,.08);padding-bottom:.5rem;}
.btn-outline{
  width:100%;padding:.85rem;border:1px solid rgba(240,192,64,.4);
  border-radius:12px;cursor:pointer;
  background:transparent;color:rgba(240,192,64,.9);
  font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:700;transition:.2s;
}
.btn-outline:hover{background:rgba(240,192,64,.1)}
#err{display:none;color:#ff9999;font-size:.85rem;margin-bottom:.7rem;background:rgba(255,0,0,.1);border-radius:8px;padding:.5rem;text-align:center}

/* ===== WAITING ===== */
#waiting{
  position:fixed;inset:0;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#2d6a3f 0%,#1a3d24 55%,#0a1a0f 100%);
  z-index:100;
}
.big-code{font-size:4rem;font-weight:900;letter-spacing:.4em;color:#f0c040;filter:drop-shadow(0 0 20px rgba(240,192,64,.5));margin:.5rem 0 1rem;}
.copy-btn{background:none;border:1px solid rgba(240,192,64,.3);color:rgba(240,192,64,.7);border-radius:8px;padding:.4rem 1rem;cursor:pointer;font-family:'Tajawal',sans-serif;margin-bottom:1.5rem;transition:.2s;}
.copy-btn:hover{background:rgba(240,192,64,.1)}
.wplayers-box{background:rgba(0,0,0,.3);border:1px solid rgba(240,192,64,.2);border-radius:16px;padding:1.2rem;width:100%;max-width:360px;margin-bottom:1.2rem;}
.wp{display:flex;align-items:center;gap:.8rem;padding:.5rem;border-radius:8px}
.wp-av{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem;background:linear-gradient(135deg,#2d6a3f,#48bb78);flex-shrink:0;}
.wp-av.empty{background:rgba(255,255,255,.08);color:rgba(255,255,255,.3);font-size:1.4rem}
.badge{font-size:.65rem;padding:.2rem .5rem;border-radius:4px;background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0f00;font-weight:700;margin-right:.4rem;}
.btn-start{background:linear-gradient(135deg,#f0c040,#c8960c);border:none;border-radius:14px;padding:1rem 3rem;color:#1a0f00;font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:700;cursor:pointer;transition:.2s;margin-bottom:.5rem;}
.btn-start:hover{filter:brightness(1.1);transform:translateY(-1px)}
.wait-msg{color:rgba(255,255,255,.35);font-size:.85rem;margin-top:.5rem}

/* ===== GAME TABLE ===== */
#game{
  display:none;
  width:100vw;height:100vh;
  position:relative;
  overflow:hidden;
  background: #2a5c38;
}

#game::before{
  content:'';position:absolute;inset:0;
  background: radial-gradient(ellipse 70% 60% at 50% 50%, #3a7a4a 0%, #2a5c38 60%, #1e4428 100%);
  pointer-events:none;
}

/* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ù…Ø±Ø¨Ø¹Ø© Ø£ÙƒØ«Ø± */
.carpet{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:850px; /* ØªÙƒØ¨ÙŠØ± Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  height:650px; /* ØªÙƒØ¨ÙŠØ± Ø·ÙˆÙ„ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  border-radius:30px;
  background: 
    repeating-linear-gradient(45deg, rgba(180,120,40,.15) 0px, rgba(180,120,40,.15) 2px, transparent 2px, transparent 12px),
    linear-gradient(135deg, #3d7a52, #2d6040, #3d7a52);
  border:6px solid rgba(240,192,64,.6);
  box-shadow:0 0 120px rgba(0,0,0,.8), inset 0 0 60px rgba(0,0,0,.4);
  z-index:1;
}

/* ØªÙƒØ¨ÙŠØ± Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© (Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙˆØ§Ù„Ø¬Ø§Ù†Ø¨ÙŠ) */
.player-top{ position:absolute;top:20px;left:50%;transform:translateX(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-right{ position:absolute;right:30px;top:50%;transform:translateY(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-left{ position:absolute;left:30px;top:50%;transform:translateY(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-bottom{ position:absolute;bottom:0;left:50%;transform:translateX(-50%); display:flex;flex-direction:column;align-items:center;padding-bottom:15px;z-index:10;width:100%; }

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ - ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ù…Ø±Ø¨Ø¹ */
.player-info{
  background:rgba(0,0,0,0.8);
  border:3px solid rgba(240,192,64,.4);
  border-radius:25px;
  padding:15px 35px;
  display:flex;align-items:center;gap:20px;
  font-size:1.6rem;font-weight:900;
  margin:15px 0;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}
.player-info.my-turn{ border-color:#f0c040; box-shadow:0 0 40px rgba(240,192,64,0.7); color:#f0c040; }
.p-av{ width:60px; height:60px; font-size:1.8rem; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#2d6a3f,#48bb78); }

/* Ø¨ÙˆØ±Ø¯ Ø§Ù„ÙˆØ³Ø· - Ø§Ù„ÙƒØ±ÙˆØª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
.board-center{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  z-index:5;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:50px;
}
.board-card{
  width:140px;height:200px; /* ØªÙƒØ¨ÙŠØ± ÙƒØ±ÙˆØª Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  background:linear-gradient(145deg,#fffff8,#f0f0e0);
  border-radius:15px;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:15px;
  box-shadow:0 15px 40px rgba(0,0,0,.7);
  position:relative;
  color:#1a1a1a;
  font-weight:900;
  transform: rotate(-3deg); /* Ù…ÙŠÙ„Ø§Ù† Ø®ÙÙŠÙ */
}
.board-card.face-card{ background-size: cover !important; background-position: center !important; }
.board-card.empty{ background:rgba(0,0,0,.3); border:4px dashed rgba(255,255,255,.1); box-shadow:none; transform: none; }
.board-card .bc-corner{font-size:1.5rem;}
.board-card .bc-center{font-size:5rem; position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
.board-card .bc-range{
  position:absolute;bottom:-40px;left:50%;transform:translateX(-50%);
  font-size:1.2rem;color:#f0c040;white-space:nowrap;
  background:rgba(0,0,0,.85);border-radius:12px;padding:6px 20px;
}

/* Ø£ÙˆØ±Ø§Ù‚ÙŠ - ØªØµÙ…ÙŠÙ… "ØªØ¯Ø§Ø®Ù„ ÙƒÙ…Ù„Ù†Ø§" */
.my-hand-area{ position: relative; display:flex; flex-direction:column; align-items:center; width:100%; }
.my-hand-cards{ display:flex; padding:20px 50px 60px; justify-content: center; }
.hc{
  flex-shrink:0;
  width:150px;height:220px; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ØªØ­Øª */
  background:linear-gradient(145deg,#fffff8,#f0f0e0);
  border-radius:18px;
  margin-left: -90px; /* Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
  display:flex;flex-direction:column;justify-content:space-between;
  padding:15px;
  box-shadow: -8px 0 20px rgba(0,0,0,0.5);
  cursor:not-allowed;
  transition: .2s;
  color:#1a1a1a;
  position:relative;
  z-index: 1;
  transform: rotate(-2deg); /* Ù…ÙŠÙ„Ø§Ù† */
}
.hc:first-child { margin-left: 0; }
.hc.face-card{ background-size: cover !important; }
.hc.ok{
  cursor:pointer;
  box-shadow:0 0 0 6px #f0c040, 0 25px 50px rgba(0,0,0,0.9);
  transform:translateY(-50px) rotate(0deg); /* ØªØ·Ù„Ø¹ ÙÙˆÙ‚ ÙˆØªØ¹ØªØ¯Ù„ */
  z-index: 10;
}
.hc.ok:hover{ transform:translateY(-70px); z-index: 20; }
.hc .cor{font-size:1.8rem;font-weight:900;}
.hc .ctr{font-size:5.5rem;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}

/* Ø®Ø§Ù†Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø±ÙÙˆØ¹Ø© ÙÙˆÙ‚ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ */
.controls-overlay{
  position: absolute;
  top: -110px; /* Ø±ÙØ¹Ù‡Ù… ÙÙˆÙ‚ Ø§Ù„ÙƒØ±ÙˆØª Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ */
  display: flex;
  gap: 25px;
  z-index: 30;
  align-items: center;
}
.pass-btn{
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00; border:none;
  padding:12px 40px; font-size:1.4rem; font-weight:900;
  border-radius:18px; cursor:pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}
.pass-btn:disabled{ background:rgba(255,255,255,0.1); color:rgba(255,255,255,0.3); cursor:default; box-shadow: none; }
.card-count-badge{
  background:rgba(0,0,0,0.7); border:2px solid #f0c040;
  padding:12px 25px; border-radius:18px; font-size:1.3rem; font-weight:900; color:#f0c040;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ± Ø®Ø§Ø±Ø¬ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© */
.turn-banner{
  position:absolute;
  bottom: 250px; /* ØªØ­Øª Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© ÙˆÙÙˆÙ‚ Ø§Ù„ÙŠØ¯ */
  left:50%;transform:translateX(-50%);
  z-index:40;
  background:rgba(240,192,64,0.95);
  color:#000; font-weight:900; font-size:1.6rem;
  padding:12px 40px; border-radius:45px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.6);
}

/* Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø®ØµÙˆÙ… */
.opp-card-back{
  width:85px; height:125px; 
  background:linear-gradient(145deg,#1a4a2a,#0d2b18);
  border:2px solid rgba(240,192,64,.5);
  border-radius:12px;
  box-shadow:3px 3px 12px rgba(0,0,0,0.6);
  margin:-35px;
}
.opp-hand.vertical .opp-card-back{ width:125px; height:85px; margin:-30px 0; }
</style>
</head>
<body>

<div id="lobby">
  <div class="lobby-inner">
    <div class="game-title">Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="suits-row">â™  <span class="r">â™¥</span> <span class="r">â™¦</span> â™£</div>
    <div class="card-panel">
      <div id="err"></div>
      <div class="flabel">Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ</div>
      <input id="pname" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="16">
      <button class="btn-gold" onclick="createRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØµÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <div class="divider">Ø£Ùˆ</div>
      <div class="flabel">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
      <input id="rcode" type="text" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§">
      <button class="btn-outline" onclick="joinRoom()">ğŸ”‘ Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
</div>

<div id="waiting">
  <div style="color:rgba(255,255,255,.5)">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
  <div class="big-code" id="wcode">------</div>
  <button class="copy-btn" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  <div class="wplayers-box" id="wplayers"></div>
  <button class="btn-start" id="startbtn" onclick="startGame()" style="display:none">ğŸƒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØµÙƒØ©</button>
</div>

<div id="game">
  <div class="carpet"></div>
  <div class="turn-banner" id="turnbanner">Ø§Ù†ØªØ¸Ø±...</div>
  
  <div class="board-center" id="board-center">
    <div id="pile-s"></div><div id="pile-h"></div>
    <div id="pile-d"></div><div id="pile-c"></div>
  </div>

  <div class="player-top" id="player-top" style="display:none">
    <div class="player-info" id="pinfo-top"><div class="p-av" id="pav-top"></div><span id="pname-top"></span></div>
    <div class="opp-hand" id="phand-top"></div>
  </div>
  
  <div class="player-right" id="player-right" style="display:none">
    <div class="opp-hand vertical" id="phand-right"></div>
    <div class="player-info" id="pinfo-right"><div class="p-av" id="pav-right"></div><span id="pname-right"></span></div>
  </div>
  
  <div class="player-left" id="player-left" style="display:none">
    <div class="opp-hand vertical" id="phand-left"></div>
    <div class="player-info" id="pinfo-left"><div class="p-av" id="pav-left"></div><span id="pname-left"></span></div>
  </div>

  <div class="player-bottom">
    <div class="my-hand-area">
      <div class="controls-overlay">
        <div class="card-count-badge">Ø£ÙˆØ±Ø§Ù‚ÙŠ: <span id="mycount">0</span></div>
        <button class="pass-btn" id="passbtn" onclick="sendPass()" disabled>ØªÙ…Ø±ÙŠØ± â†©</button>
      </div>
      <div class="my-hand-cards" id="myhand"></div>
    </div>
  </div>
</div>

<script>
const VALS={11:'J',12:'Q',13:'K',14:'A'};
const RED={'â™¥':1,'â™¦':1};
const FACE_CARD_IMAGES = {
  'â™ J': 'https://upload.wikimedia.org/wikipedia/commons/a/a9/Jack_of_spades2.svg',
  'â™ Q': 'https://upload.wikimedia.org/wikipedia/commons/4/4d/Queen_of_spades2.svg',
  'â™ K': 'https://upload.wikimedia.org/wikipedia/commons/f/f1/King_of_spades2.svg',
  'â™¥J': 'https://upload.wikimedia.org/wikipedia/commons/3/34/Jack_of_hearts2.svg',
  'â™¥Q': 'https://upload.wikimedia.org/wikipedia/commons/5/57/Queen_of_hearts2.svg',
  'â™¥K': 'https://upload.wikimedia.org/wikipedia/commons/7/72/King_of_hearts2.svg',
  'â™¦J': 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Jack_of_diamonds2.svg',
  'â™¦Q': 'https://upload.wikimedia.org/wikipedia/commons/8/89/Queen_of_diamonds2.svg',
  'â™¦K': 'https://upload.wikimedia.org/wikipedia/commons/d/d3/King_of_diamonds2.svg',
  'â™£J': 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Jack_of_clubs2.svg',
  'â™£Q': 'https://upload.wikimedia.org/wikipedia/commons/8/8b/Queen_of_clubs2.svg',
  'â™£K': 'https://upload.wikimedia.org/wikipedia/commons/f/f4/King_of_clubs2.svg'
};

const WS_URL=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.host}`;
let ws,myId,myRoomId,isHost=false,gameState=null;

function connect(cb){
  ws=new WebSocket(WS_URL);
  ws.onopen=cb;
  ws.onmessage=e=>handle(JSON.parse(e.data));
  ws.onclose=()=>alert('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„');
}

function createRoom(){
  const name=document.getElementById('pname').value.trim();
  if(!name)return;
  connect(()=>ws.send(JSON.stringify({type:'create_room',name})));
}

function joinRoom(){
  const name=document.getElementById('pname').value.trim();
  const code=document.getElementById('rcode').value.trim().toUpperCase();
  if(!name||!code)return;
  connect(()=>ws.send(JSON.stringify({type:'join_room',roomId:code,name})));
}

function startGame(){ws.send(JSON.stringify({type:'start_game'}));}
function sendPass(){ws.send(JSON.stringify({type:'pass'}));}
function copyCode(){navigator.clipboard.writeText(myRoomId); alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯');}

function handle(msg){
  if(msg.type==='room_created'||msg.type==='joined_room'){
    myId=msg.playerId; myRoomId=msg.roomId; isHost=(msg.type==='room_created');
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
    if(isHost)document.getElementById('startbtn').style.display='block';
  }
  else if(msg.type==='player_list'){renderWaiting(msg.players);}
  else if(msg.type==='game_started'){
    document.getElementById('waiting').style.display='none';
    document.getElementById('game').style.display='block';
  }
  else if(msg.type==='game_state'){renderGame(msg);}
}

function renderWaiting(players){
  const el=document.getElementById('wplayers'); el.innerHTML='';
  players.forEach((p,i)=>{
    const d=document.createElement('div'); d.className='wp';
    d.innerHTML=`<div class="wp-av">${p.name[0]}</div><span>${p.name} ${p.id===myId?'(Ø£Ù†Øª)':''}</span>`;
    el.appendChild(d);
  });
}

function vd(v){return VALS[v]||v;}

function renderGame(s){
  gameState=s;
  const suitIds={'â™ ':'pile-s','â™¥':'pile-h','â™¦':'pile-d','â™£':'pile-c'};
  
  // Ø§Ù„ÙˆØ³Ø·
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=s.board[suit];
    const pile=document.getElementById(suitIds[suit]);
    if(!b){
      pile.innerHTML=`<div class="board-card empty"><div class="bc-center">${suit}</div></div>`;
    }else{
      const isFace=b.high>10;
      const img=isFace?FACE_CARD_IMAGES[suit+vd(b.high)]:null;
      pile.innerHTML=`<div class="board-card ${RED[suit]?'r':''} ${isFace?'face-card':''}" style="${isFace?`background:url(${img})`:''}">
        ${!isFace?`<div class="bc-corner"><div>${vd(b.high)}</div><div>${suit}</div></div><div class="bc-center">${suit}</div>`:''}
        <div class="bc-range">${vd(b.low)} â€” ${vd(b.high)}</div>
      </div>`;
    }
  });

  // Ø§Ù„Ø®ØµÙˆÙ… (ØªØ¨Ø³ÙŠØ· Ù„Ù„Ù…Ø«Ø§Ù„)
  const otherPlayers = s.players.filter(p=>p.id!==myId);
  const slots=['top','right','left'];
  slots.forEach((slot,idx)=>{
    const p = otherPlayers[idx];
    const wrap = document.getElementById('player-'+slot);
    if(p){
      wrap.style.display='flex';
      document.getElementById('pname-'+slot).textContent=p.name + (p.isOut?' âœ…':'');
      document.getElementById('pav-'+slot).textContent=p.name[0];
      const h = document.getElementById('phand-'+slot);
      h.innerHTML='';
      for(let i=0; i<Math.min(p.cardCount,8); i++) h.innerHTML+='<div class="opp-card-back"></div>';
    }
  });

  // ÙŠØ¯ÙŠ
  const hand=document.getElementById('myhand');
  hand.innerHTML='';
  const isMyTurn = (s.currentPlayerId === myId);
  s.myHand.sort((a,b)=>a.value-b.value).forEach(card=>{
    const valid = isMyTurn && s.validMoves.find(m=>m.suit===card.suit && m.value===card.value);
    const isFace = card.value > 10;
    const img = isFace ? FACE_CARD_IMAGES[card.suit+vd(card.value)] : null;
    const el=document.createElement('div');
    el.className=`hc ${RED[card.suit]?'r':''} ${valid?'ok':''} ${isFace?'face-card':''}`;
    if(isFace) el.style.background=`url(${img})`;
    else el.innerHTML=`<div class="cor"><div>${vd(card.value)}</div><div>${card.suit}</div></div><div class="ctr">${card.suit}</div>`;
    if(valid) el.onclick=()=>ws.send(JSON.stringify({type:'play_card',card}));
    hand.appendChild(el);
  });

  // Ø²Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙˆÙ…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆØ±
  document.getElementById('mycount').textContent=s.myHand.length;
  const pb=document.getElementById('passbtn');
  // ÙŠØªÙØ¹Ù„ Ø²Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¯ÙˆØ±ÙŠ ÙˆÙ…Ø§ Ø¹Ù†Ø¯ÙŠ Ø­Ø±ÙƒØ§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©
  pb.disabled = !(isMyTurn && s.validMoves.length === 0);
  
  const curPlayer=s.players.find(p=>p.id===s.currentPlayerId);
  document.getElementById('turnbanner').textContent = isMyTurn ? 'â­ Ø¯ÙˆØ±Ùƒ ÙŠØ§ Ø¨Ø·Ù„!' : 'â³ Ø¯ÙˆØ±: ' + curPlayer.name;
  document.getElementById('turnbanner').style.background = isMyTurn ? '#f0c040' : 'rgba(240,192,64,0.8)';
}
</script>
</body>
</html><!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù† ğŸƒ - Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ø´Ø§Ù…Ù‰</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;font-family:'Tajawal',sans-serif;background:#0a1a0a;color:#fff;overflow:hidden}

/* ===== LOBBY ===== */
#lobby{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#2d6a3f 0%,#1a3d24 55%,#0a1a0f 100%);
  z-index:100;
}
.lobby-inner{width:100%;max-width:420px;padding:1.5rem;text-align:center;}
.game-title{
  font-size:3rem;font-weight:900;
  background:linear-gradient(135deg,#f0c040,#c8960c,#f0c040);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  margin-bottom:.3rem;
}
.suits-row{font-size:1.8rem;letter-spacing:.5rem;margin-bottom:2rem;opacity:.9}
.suits-row .r{color:#ff4444}
.card-panel{
  background:rgba(0,0,0,.35);
  border:2px solid rgba(240,192,64,.3);
  border-radius:18px;padding:1.8rem;
  box-shadow:0 20px 60px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.05);
}
.flabel{font-size:.82rem;color:rgba(240,192,64,.8);text-align:right;margin-bottom:.35rem;font-weight:700}
input{
  width:100%;padding:.85rem 1rem;
  background:rgba(0,0,0,.4);
  border:1px solid rgba(240,192,64,.25);
  border-radius:10px;color:#fff;
  font-family:'Tajawal',sans-serif;font-size:1rem;
  margin-bottom:.9rem;text-align:right;outline:none;transition:.2s;
}
input:focus{border-color:rgba(240,192,64,.7);box-shadow:0 0 0 3px rgba(240,192,64,.1)}
.btn-gold{
  width:100%;padding:.9rem;border:none;border-radius:12px;cursor:pointer;
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00;font-family:'Tajawal',sans-serif;
  font-size:1rem;font-weight:700;margin-bottom:.7rem;transition:.2s;
}
.btn-gold:hover{filter:brightness(1.1);transform:translateY(-1px)}
.divider{text-align:center;color:rgba(255,255,255,.3);font-size:.8rem;margin:.5rem 0 .9rem;border-bottom:1px solid rgba(255,255,255,.08);padding-bottom:.5rem;}
.btn-outline{
  width:100%;padding:.85rem;border:1px solid rgba(240,192,64,.4);
  border-radius:12px;cursor:pointer;
  background:transparent;color:rgba(240,192,64,.9);
  font-family:'Tajawal',sans-serif;font-size:1rem;font-weight:700;transition:.2s;
}
.btn-outline:hover{background:rgba(240,192,64,.1)}
#err{display:none;color:#ff9999;font-size:.85rem;margin-bottom:.7rem;background:rgba(255,0,0,.1);border-radius:8px;padding:.5rem;text-align:center}

/* ===== WAITING ===== */
#waiting{
  position:fixed;inset:0;display:none;
  flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at center,#2d6a3f 0%,#1a3d24 55%,#0a1a0f 100%);
  z-index:100;
}
.big-code{font-size:4rem;font-weight:900;letter-spacing:.4em;color:#f0c040;filter:drop-shadow(0 0 20px rgba(240,192,64,.5));margin:.5rem 0 1rem;}
.copy-btn{background:none;border:1px solid rgba(240,192,64,.3);color:rgba(240,192,64,.7);border-radius:8px;padding:.4rem 1rem;cursor:pointer;font-family:'Tajawal',sans-serif;margin-bottom:1.5rem;transition:.2s;}
.copy-btn:hover{background:rgba(240,192,64,.1)}
.wplayers-box{background:rgba(0,0,0,.3);border:1px solid rgba(240,192,64,.2);border-radius:16px;padding:1.2rem;width:100%;max-width:360px;margin-bottom:1.2rem;}
.wp{display:flex;align-items:center;gap:.8rem;padding:.5rem;border-radius:8px}
.wp-av{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem;background:linear-gradient(135deg,#2d6a3f,#48bb78);flex-shrink:0;}
.wp-av.empty{background:rgba(255,255,255,.08);color:rgba(255,255,255,.3);font-size:1.4rem}
.badge{font-size:.65rem;padding:.2rem .5rem;border-radius:4px;background:linear-gradient(135deg,#f0c040,#c8960c);color:#1a0f00;font-weight:700;margin-right:.4rem;}
.btn-start{background:linear-gradient(135deg,#f0c040,#c8960c);border:none;border-radius:14px;padding:1rem 3rem;color:#1a0f00;font-family:'Tajawal',sans-serif;font-size:1.1rem;font-weight:700;cursor:pointer;transition:.2s;margin-bottom:.5rem;}
.btn-start:hover{filter:brightness(1.1);transform:translateY(-1px)}
.wait-msg{color:rgba(255,255,255,.35);font-size:.85rem;margin-top:.5rem}

/* ===== GAME TABLE ===== */
#game{
  display:none;
  width:100vw;height:100vh;
  position:relative;
  overflow:hidden;
  background: #2a5c38;
}

#game::before{
  content:'';position:absolute;inset:0;
  background: radial-gradient(ellipse 70% 60% at 50% 50%, #3a7a4a 0%, #2a5c38 60%, #1e4428 100%);
  pointer-events:none;
}

/* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ù…Ø±Ø¨Ø¹Ø© Ø£ÙƒØ«Ø± */
.carpet{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:850px; /* ØªÙƒØ¨ÙŠØ± Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  height:650px; /* ØªÙƒØ¨ÙŠØ± Ø·ÙˆÙ„ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  border-radius:30px;
  background: 
    repeating-linear-gradient(45deg, rgba(180,120,40,.15) 0px, rgba(180,120,40,.15) 2px, transparent 2px, transparent 12px),
    linear-gradient(135deg, #3d7a52, #2d6040, #3d7a52);
  border:6px solid rgba(240,192,64,.6);
  box-shadow:0 0 120px rgba(0,0,0,.8), inset 0 0 60px rgba(0,0,0,.4);
  z-index:1;
}

/* ØªÙƒØ¨ÙŠØ± Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© (Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙˆØ§Ù„Ø¬Ø§Ù†Ø¨ÙŠ) */
.player-top{ position:absolute;top:20px;left:50%;transform:translateX(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-right{ position:absolute;right:30px;top:50%;transform:translateY(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-left{ position:absolute;left:30px;top:50%;transform:translateY(-50%); display:flex;flex-direction:column;align-items:center;z-index:10; }
.player-bottom{ position:absolute;bottom:0;left:50%;transform:translateX(-50%); display:flex;flex-direction:column;align-items:center;padding-bottom:15px;z-index:10;width:100%; }

/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ - ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ù…Ø±Ø¨Ø¹ */
.player-info{
  background:rgba(0,0,0,0.8);
  border:3px solid rgba(240,192,64,.4);
  border-radius:25px;
  padding:15px 35px;
  display:flex;align-items:center;gap:20px;
  font-size:1.6rem;font-weight:900;
  margin:15px 0;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}
.player-info.my-turn{ border-color:#f0c040; box-shadow:0 0 40px rgba(240,192,64,0.7); color:#f0c040; }
.p-av{ width:60px; height:60px; font-size:1.8rem; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,#2d6a3f,#48bb78); }

/* Ø¨ÙˆØ±Ø¯ Ø§Ù„ÙˆØ³Ø· - Ø§Ù„ÙƒØ±ÙˆØª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
.board-center{
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%);
  z-index:5;
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:50px;
}
.board-card{
  width:140px;height:200px; /* ØªÙƒØ¨ÙŠØ± ÙƒØ±ÙˆØª Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© */
  background:linear-gradient(145deg,#fffff8,#f0f0e0);
  border-radius:15px;
  display:flex;flex-direction:column;justify-content:space-between;
  padding:15px;
  box-shadow:0 15px 40px rgba(0,0,0,.7);
  position:relative;
  color:#1a1a1a;
  font-weight:900;
  transform: rotate(-3deg); /* Ù…ÙŠÙ„Ø§Ù† Ø®ÙÙŠÙ */
}
.board-card.face-card{ background-size: cover !important; background-position: center !important; }
.board-card.empty{ background:rgba(0,0,0,.3); border:4px dashed rgba(255,255,255,.1); box-shadow:none; transform: none; }
.board-card .bc-corner{font-size:1.5rem;}
.board-card .bc-center{font-size:5rem; position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}
.board-card .bc-range{
  position:absolute;bottom:-40px;left:50%;transform:translateX(-50%);
  font-size:1.2rem;color:#f0c040;white-space:nowrap;
  background:rgba(0,0,0,.85);border-radius:12px;padding:6px 20px;
}

/* Ø£ÙˆØ±Ø§Ù‚ÙŠ - ØªØµÙ…ÙŠÙ… "ØªØ¯Ø§Ø®Ù„ ÙƒÙ…Ù„Ù†Ø§" */
.my-hand-area{ position: relative; display:flex; flex-direction:column; align-items:center; width:100%; }
.my-hand-cards{ display:flex; padding:20px 50px 60px; justify-content: center; }
.hc{
  flex-shrink:0;
  width:150px;height:220px; /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ØªØ­Øª */
  background:linear-gradient(145deg,#fffff8,#f0f0e0);
  border-radius:18px;
  margin-left: -90px; /* Ø§Ù„ØªØ¯Ø§Ø®Ù„ */
  display:flex;flex-direction:column;justify-content:space-between;
  padding:15px;
  box-shadow: -8px 0 20px rgba(0,0,0,0.5);
  cursor:not-allowed;
  transition: .2s;
  color:#1a1a1a;
  position:relative;
  z-index: 1;
  transform: rotate(-2deg); /* Ù…ÙŠÙ„Ø§Ù† */
}
.hc:first-child { margin-left: 0; }
.hc.face-card{ background-size: cover !important; }
.hc.ok{
  cursor:pointer;
  box-shadow:0 0 0 6px #f0c040, 0 25px 50px rgba(0,0,0,0.9);
  transform:translateY(-50px) rotate(0deg); /* ØªØ·Ù„Ø¹ ÙÙˆÙ‚ ÙˆØªØ¹ØªØ¯Ù„ */
  z-index: 10;
}
.hc.ok:hover{ transform:translateY(-70px); z-index: 20; }
.hc .cor{font-size:1.8rem;font-weight:900;}
.hc .ctr{font-size:5.5rem;text-align:center;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}

/* Ø®Ø§Ù†Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ø±ÙÙˆØ¹Ø© ÙÙˆÙ‚ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ */
.controls-overlay{
  position: absolute;
  top: -110px; /* Ø±ÙØ¹Ù‡Ù… ÙÙˆÙ‚ Ø§Ù„ÙƒØ±ÙˆØª Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ */
  display: flex;
  gap: 25px;
  z-index: 30;
  align-items: center;
}
.pass-btn{
  background:linear-gradient(135deg,#f0c040,#c8960c);
  color:#1a0f00; border:none;
  padding:12px 40px; font-size:1.4rem; font-weight:900;
  border-radius:18px; cursor:pointer;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}
.pass-btn:disabled{ background:rgba(255,255,255,0.1); color:rgba(255,255,255,0.3); cursor:default; box-shadow: none; }
.card-count-badge{
  background:rgba(0,0,0,0.7); border:2px solid #f0c040;
  padding:12px 25px; border-radius:18px; font-size:1.3rem; font-weight:900; color:#f0c040;
}

/* Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ± Ø®Ø§Ø±Ø¬ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¬Ù„Ø³Ø© */
.turn-banner{
  position:absolute;
  bottom: 250px; /* ØªØ­Øª Ø§Ù„Ø³Ø¬Ø§Ø¯Ø© ÙˆÙÙˆÙ‚ Ø§Ù„ÙŠØ¯ */
  left:50%;transform:translateX(-50%);
  z-index:40;
  background:rgba(240,192,64,0.95);
  color:#000; font-weight:900; font-size:1.6rem;
  padding:12px 40px; border-radius:45px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.6);
}

/* Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø®ØµÙˆÙ… */
.opp-card-back{
  width:85px; height:125px; 
  background:linear-gradient(145deg,#1a4a2a,#0d2b18);
  border:2px solid rgba(240,192,64,.5);
  border-radius:12px;
  box-shadow:3px 3px 12px rgba(0,0,0,0.6);
  margin:-35px;
}
.opp-hand.vertical .opp-card-back{ width:125px; height:85px; margin:-30px 0; }
</style>
</head>
<body>

<div id="lobby">
  <div class="lobby-inner">
    <div class="game-title">Ø³Ø¨Ø¹Ø© Ø§Ù„Ø¯ÙŠÙ…Ù†</div>
    <div class="suits-row">â™  <span class="r">â™¥</span> <span class="r">â™¦</span> â™£</div>
    <div class="card-panel">
      <div id="err"></div>
      <div class="flabel">Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ</div>
      <input id="pname" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ..." maxlength="16">
      <button class="btn-gold" onclick="createRoom()">ğŸ  Ø¥Ù†Ø´Ø§Ø¡ ØµÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <div class="divider">Ø£Ùˆ</div>
      <div class="flabel">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
      <input id="rcode" type="text" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§">
      <button class="btn-outline" onclick="joinRoom()">ğŸ”‘ Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
</div>

<div id="waiting">
  <div style="color:rgba(255,255,255,.5)">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
  <div class="big-code" id="wcode">------</div>
  <button class="copy-btn" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
  <div class="wplayers-box" id="wplayers"></div>
  <button class="btn-start" id="startbtn" onclick="startGame()" style="display:none">ğŸƒ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØµÙƒØ©</button>
</div>

<div id="game">
  <div class="carpet"></div>
  <div class="turn-banner" id="turnbanner">Ø§Ù†ØªØ¸Ø±...</div>
  
  <div class="board-center" id="board-center">
    <div id="pile-s"></div><div id="pile-h"></div>
    <div id="pile-d"></div><div id="pile-c"></div>
  </div>

  <div class="player-top" id="player-top" style="display:none">
    <div class="player-info" id="pinfo-top"><div class="p-av" id="pav-top"></div><span id="pname-top"></span></div>
    <div class="opp-hand" id="phand-top"></div>
  </div>
  
  <div class="player-right" id="player-right" style="display:none">
    <div class="opp-hand vertical" id="phand-right"></div>
    <div class="player-info" id="pinfo-right"><div class="p-av" id="pav-right"></div><span id="pname-right"></span></div>
  </div>
  
  <div class="player-left" id="player-left" style="display:none">
    <div class="opp-hand vertical" id="phand-left"></div>
    <div class="player-info" id="pinfo-left"><div class="p-av" id="pav-left"></div><span id="pname-left"></span></div>
  </div>

  <div class="player-bottom">
    <div class="my-hand-area">
      <div class="controls-overlay">
        <div class="card-count-badge">Ø£ÙˆØ±Ø§Ù‚ÙŠ: <span id="mycount">0</span></div>
        <button class="pass-btn" id="passbtn" onclick="sendPass()" disabled>ØªÙ…Ø±ÙŠØ± â†©</button>
      </div>
      <div class="my-hand-cards" id="myhand"></div>
    </div>
  </div>
</div>

<script>
const VALS={11:'J',12:'Q',13:'K',14:'A'};
const RED={'â™¥':1,'â™¦':1};
const FACE_CARD_IMAGES = {
  'â™ J': 'https://upload.wikimedia.org/wikipedia/commons/a/a9/Jack_of_spades2.svg',
  'â™ Q': 'https://upload.wikimedia.org/wikipedia/commons/4/4d/Queen_of_spades2.svg',
  'â™ K': 'https://upload.wikimedia.org/wikipedia/commons/f/f1/King_of_spades2.svg',
  'â™¥J': 'https://upload.wikimedia.org/wikipedia/commons/3/34/Jack_of_hearts2.svg',
  'â™¥Q': 'https://upload.wikimedia.org/wikipedia/commons/5/57/Queen_of_hearts2.svg',
  'â™¥K': 'https://upload.wikimedia.org/wikipedia/commons/7/72/King_of_hearts2.svg',
  'â™¦J': 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Jack_of_diamonds2.svg',
  'â™¦Q': 'https://upload.wikimedia.org/wikipedia/commons/8/89/Queen_of_diamonds2.svg',
  'â™¦K': 'https://upload.wikimedia.org/wikipedia/commons/d/d3/King_of_diamonds2.svg',
  'â™£J': 'https://upload.wikimedia.org/wikipedia/commons/b/b7/Jack_of_clubs2.svg',
  'â™£Q': 'https://upload.wikimedia.org/wikipedia/commons/8/8b/Queen_of_clubs2.svg',
  'â™£K': 'https://upload.wikimedia.org/wikipedia/commons/f/f4/King_of_clubs2.svg'
};

const WS_URL=location.protocol==='https:'?`wss://${location.host}`:`ws://${location.host}`;
let ws,myId,myRoomId,isHost=false,gameState=null;

function connect(cb){
  ws=new WebSocket(WS_URL);
  ws.onopen=cb;
  ws.onmessage=e=>handle(JSON.parse(e.data));
  ws.onclose=()=>alert('Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„');
}

function createRoom(){
  const name=document.getElementById('pname').value.trim();
  if(!name)return;
  connect(()=>ws.send(JSON.stringify({type:'create_room',name})));
}

function joinRoom(){
  const name=document.getElementById('pname').value.trim();
  const code=document.getElementById('rcode').value.trim().toUpperCase();
  if(!name||!code)return;
  connect(()=>ws.send(JSON.stringify({type:'join_room',roomId:code,name})));
}

function startGame(){ws.send(JSON.stringify({type:'start_game'}));}
function sendPass(){ws.send(JSON.stringify({type:'pass'}));}
function copyCode(){navigator.clipboard.writeText(myRoomId); alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯');}

function handle(msg){
  if(msg.type==='room_created'||msg.type==='joined_room'){
    myId=msg.playerId; myRoomId=msg.roomId; isHost=(msg.type==='room_created');
    document.getElementById('lobby').style.display='none';
    document.getElementById('waiting').style.display='flex';
    document.getElementById('wcode').textContent=myRoomId;
    if(isHost)document.getElementById('startbtn').style.display='block';
  }
  else if(msg.type==='player_list'){renderWaiting(msg.players);}
  else if(msg.type==='game_started'){
    document.getElementById('waiting').style.display='none';
    document.getElementById('game').style.display='block';
  }
  else if(msg.type==='game_state'){renderGame(msg);}
}

function renderWaiting(players){
  const el=document.getElementById('wplayers'); el.innerHTML='';
  players.forEach((p,i)=>{
    const d=document.createElement('div'); d.className='wp';
    d.innerHTML=`<div class="wp-av">${p.name[0]}</div><span>${p.name} ${p.id===myId?'(Ø£Ù†Øª)':''}</span>`;
    el.appendChild(d);
  });
}

function vd(v){return VALS[v]||v;}

function renderGame(s){
  gameState=s;
  const suitIds={'â™ ':'pile-s','â™¥':'pile-h','â™¦':'pile-d','â™£':'pile-c'};
  
  // Ø§Ù„ÙˆØ³Ø·
  ['â™ ','â™¥','â™¦','â™£'].forEach(suit=>{
    const b=s.board[suit];
    const pile=document.getElementById(suitIds[suit]);
    if(!b){
      pile.innerHTML=`<div class="board-card empty"><div class="bc-center">${suit}</div></div>`;
    }else{
      const isFace=b.high>10;
      const img=isFace?FACE_CARD_IMAGES[suit+vd(b.high)]:null;
      pile.innerHTML=`<div class="board-card ${RED[suit]?'r':''} ${isFace?'face-card':''}" style="${isFace?`background:url(${img})`:''}">
        ${!isFace?`<div class="bc-corner"><div>${vd(b.high)}</div><div>${suit}</div></div><div class="bc-center">${suit}</div>`:''}
        <div class="bc-range">${vd(b.low)} â€” ${vd(b.high)}</div>
      </div>`;
    }
  });

  // Ø§Ù„Ø®ØµÙˆÙ… (ØªØ¨Ø³ÙŠØ· Ù„Ù„Ù…Ø«Ø§Ù„)
  const otherPlayers = s.players.filter(p=>p.id!==myId);
  const slots=['top','right','left'];
  slots.forEach((slot,idx)=>{
    const p = otherPlayers[idx];
    const wrap = document.getElementById('player-'+slot);
    if(p){
      wrap.style.display='flex';
      document.getElementById('pname-'+slot).textContent=p.name + (p.isOut?' âœ…':'');
      document.getElementById('pav-'+slot).textContent=p.name[0];
      const h = document.getElementById('phand-'+slot);
      h.innerHTML='';
      for(let i=0; i<Math.min(p.cardCount,8); i++) h.innerHTML+='<div class="opp-card-back"></div>';
    }
  });

  // ÙŠØ¯ÙŠ
  const hand=document.getElementById('myhand');
  hand.innerHTML='';
  const isMyTurn = (s.currentPlayerId === myId);
  s.myHand.sort((a,b)=>a.value-b.value).forEach(card=>{
    const valid = isMyTurn && s.validMoves.find(m=>m.suit===card.suit && m.value===card.value);
    const isFace = card.value > 10;
    const img = isFace ? FACE_CARD_IMAGES[card.suit+vd(card.value)] : null;
    const el=document.createElement('div');
    el.className=`hc ${RED[card.suit]?'r':''} ${valid?'ok':''} ${isFace?'face-card':''}`;
    if(isFace) el.style.background=`url(${img})`;
    else el.innerHTML=`<div class="cor"><div>${vd(card.value)}</div><div>${card.suit}</div></div><div class="ctr">${card.suit}</div>`;
    if(valid) el.onclick=()=>ws.send(JSON.stringify({type:'play_card',card}));
    hand.appendChild(el);
  });

  // Ø²Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙˆÙ…Ù†Ø·Ù‚ Ø§Ù„Ø¯ÙˆØ±
  document.getElementById('mycount').textContent=s.myHand.length;
  const pb=document.getElementById('passbtn');
  // ÙŠØªÙØ¹Ù„ Ø²Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¯ÙˆØ±ÙŠ ÙˆÙ…Ø§ Ø¹Ù†Ø¯ÙŠ Ø­Ø±ÙƒØ§Øª Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©
  pb.disabled = !(isMyTurn && s.validMoves.length === 0);
  
  const curPlayer=s.players.find(p=>p.id===s.currentPlayerId);
  document.getElementById('turnbanner').textContent = isMyTurn ? 'â­ Ø¯ÙˆØ±Ùƒ ÙŠØ§ Ø¨Ø·Ù„!' : 'â³ Ø¯ÙˆØ±: ' + curPlayer.name;
  document.getElementById('turnbanner').style.background = isMyTurn ? '#f0c040' : 'rgba(240,192,64,0.8)';
}
</script>
</body>
</html>
